// Code generated by "gen/scripts.go"; DO NOT EDIT.

package web

const(
// DefaultAppWorkersJS is the default template used in [MakeAppWorkerJS] to generate app-worker.js.
DefaultAppWorkerJS = "const cacheName = \"app-\" + \"{{.Version}}\";\nconst resourcesToCache = {{.ResourcesToCache}};\n\nself.addEventListener(\"install\", (event) => {\n  console.log(\"installing app worker {{.Version}}\");\n\n  event.waitUntil(\n    caches\n      .open(cacheName)\n      .then((cache) => {\n        return cache.addAll(resourcesToCache);\n      })\n      .then(() => {\n        self.skipWaiting();\n      })\n  );\n});\n\nself.addEventListener(\"activate\", (event) => {\n  event.waitUntil(\n    caches.keys().then((keyList) => {\n      return Promise.all(\n        keyList.map((key) => {\n          if (key !== cacheName) {\n            return caches.delete(key);\n          }\n        })\n      );\n    })\n  );\n  console.log(\"app worker {{.Version}} is activated\");\n});\n\nself.addEventListener(\"fetch\", (event) => {\n  event.respondWith(\n    caches.match(event.request).then((response) => {\n      return response || fetch(event.request);\n    })\n  );\n});\n\nself.addEventListener(\"push\", (event) => {\n  if (!event.data || !event.data.text()) {\n    return;\n  }\n\n  const notification = JSON.parse(event.data.text());\n  if (!notification) {\n    return;\n  }\n\n  const title = notification.title;\n  delete notification.title;\n\n  if (!notification.data) {\n    notification.data = {};\n  }\n  let actions = [];\n  for (let i in notification.actions) {\n    const action = notification.actions[i];\n\n    actions.push({\n      action: action.action,\n      path: action.path,\n    });\n\n    delete action.path;\n  }\n  notification.data.goapp = {\n    path: notification.path,\n    actions: actions,\n  };\n  delete notification.path;\n\n  event.waitUntil(self.registration.showNotification(title, notification));\n});\n\nself.addEventListener(\"notificationclick\", (event) => {\n  event.notification.close();\n\n  const notification = event.notification;\n  let path = notification.data.goapp.path;\n\n  for (let i in notification.data.goapp.actions) {\n    const action = notification.data.goapp.actions[i];\n    if (action.action === event.action) {\n      path = action.path;\n      break;\n    }\n  }\n\n  event.waitUntil(\n    clients\n      .matchAll({\n        type: \"window\",\n      })\n      .then((clientList) => {\n        for (var i = 0; i < clientList.length; i++) {\n          let client = clientList[i];\n          if (\"focus\" in client) {\n            client.focus();\n            client.postMessage({\n              goapp: {\n                type: \"notification\",\n                path: path,\n              },\n            });\n            return;\n          }\n        }\n\n        if (clients.openWindow) {\n          return clients.openWindow(path);\n        }\n      })\n  );\n});\n"

// WASMExecJSGoCurrent is the wasm_exec.js file for the current version of Go.
WASMExecJSGoCurrent = "// Copyright 2018 The Go Authors. All rights reserved.\r\n// Use of this source code is governed by a BSD-style\r\n// license that can be found in the LICENSE file.\r\n\r\n\"use strict\";\r\n\r\n(() => {\r\n\tconst enosys = () => {\r\n\t\tconst err = new Error(\"not implemented\");\r\n\t\terr.code = \"ENOSYS\";\r\n\t\treturn err;\r\n\t};\r\n\r\n\tlet outputBuf = \"\";\r\n\tconst writeConsole = function (fd, buf) {\r\n\t\toutputBuf += decoder.decode(buf);\r\n\t\tconst nl = outputBuf.lastIndexOf(\"\\n\");\r\n\t\tif (nl != -1) {\r\n\t\t\tconsole.log(outputBuf.substring(0, nl));\r\n\t\t\toutputBuf = outputBuf.substring(nl + 1);\r\n\t\t}\r\n\t\treturn buf.length;\r\n\t}\r\n\r\n\tif (!globalThis.fs) {\r\n\t\t// BrowserFS.configure({ fs: \"InMemory\" })\r\n\t\tglobalThis.fs = BrowserFS.fs;\r\n\t\t// globalThis.fs.open = function (path, flags, mode, callback) {\r\n\t\t// \tconsole.log(\"open\", path, flags, mode, callback);\r\n\t\t// \tBrowserFS.fs.open(path, flags, mode, callback);\r\n\t\t// }\r\n\t\t// globalThis.fs.constants = { O_WRONLY: 1, O_RDWR: 2, O_CREAT: 512, O_TRUNC: 1024, O_APPEND: 8, O_EXCL: 2048 }\r\n\t\t// globalThis.fs.open = function (path, flags, mode, callback) {\r\n\t\t// \tObject.getPrototypeOf(globalThis.fs).open(path, flags, mode, callback);\r\n\t\t// }\r\n\t}\r\n\r\n\r\n\tif (!globalThis.process) {\r\n\t\tglobalThis.process = {\r\n\t\t\tgetuid() { return -1; },\r\n\t\t\tgetgid() { return -1; },\r\n\t\t\tgeteuid() { return -1; },\r\n\t\t\tgetegid() { return -1; },\r\n\t\t\tgetgroups() { throw enosys(); },\r\n\t\t\tpid: -1,\r\n\t\t\tppid: -1,\r\n\t\t\tumask() { throw enosys(); },\r\n\t\t\tcwd() { throw enosys(); },\r\n\t\t\tchdir() { throw enosys(); },\r\n\t\t}\r\n\t}\r\n\r\n\tif (!globalThis.crypto) {\r\n\t\tthrow new Error(\"globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)\");\r\n\t}\r\n\r\n\tif (!globalThis.performance) {\r\n\t\tthrow new Error(\"globalThis.performance is not available, polyfill required (performance.now only)\");\r\n\t}\r\n\r\n\tif (!globalThis.TextEncoder) {\r\n\t\tthrow new Error(\"globalThis.TextEncoder is not available, polyfill required\");\r\n\t}\r\n\r\n\tif (!globalThis.TextDecoder) {\r\n\t\tthrow new Error(\"globalThis.TextDecoder is not available, polyfill required\");\r\n\t}\r\n\r\n\tconst encoder = new TextEncoder(\"utf-8\");\r\n\tconst decoder = new TextDecoder(\"utf-8\");\r\n\r\n\tglobalThis.Go = class {\r\n\t\tconstructor() {\r\n\t\t\tthis.argv = [\"js\"];\r\n\t\t\tthis.env = {};\r\n\t\t\tthis.exit = (code) => {\r\n\t\t\t\tif (code !== 0) {\r\n\t\t\t\t\tconsole.error(\"exit code:\", code);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis._exitPromise = new Promise((resolve) => {\r\n\t\t\t\tthis._resolveExitPromise = resolve;\r\n\t\t\t});\r\n\t\t\tthis._pendingEvent = null;\r\n\t\t\tthis._scheduledTimeouts = new Map();\r\n\t\t\tthis._nextCallbackTimeoutID = 1;\r\n\r\n\t\t\tconst setInt64 = (addr, v) => {\r\n\t\t\t\tthis.mem.setUint32(addr + 0, v, true);\r\n\t\t\t\tthis.mem.setUint32(addr + 4, Math.floor(v / 4294967296), true);\r\n\t\t\t}\r\n\r\n\t\t\tconst setInt32 = (addr, v) => {\r\n\t\t\t\tthis.mem.setUint32(addr + 0, v, true);\r\n\t\t\t}\r\n\r\n\t\t\tconst getInt64 = (addr) => {\r\n\t\t\t\tconst low = this.mem.getUint32(addr + 0, true);\r\n\t\t\t\tconst high = this.mem.getInt32(addr + 4, true);\r\n\t\t\t\treturn low + high * 4294967296;\r\n\t\t\t}\r\n\r\n\t\t\tconst loadValue = (addr) => {\r\n\t\t\t\tconst f = this.mem.getFloat64(addr, true);\r\n\t\t\t\tif (f === 0) {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(f)) {\r\n\t\t\t\t\treturn f;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst id = this.mem.getUint32(addr, true);\r\n\t\t\t\treturn this._values[id];\r\n\t\t\t}\r\n\r\n\t\t\tconst storeValue = (addr, v) => {\r\n\t\t\t\tconst nanHead = 0x7FF80000;\r\n\r\n\t\t\t\tif (typeof v === \"number\" && v !== 0) {\r\n\t\t\t\t\tif (isNaN(v)) {\r\n\t\t\t\t\t\tthis.mem.setUint32(addr + 4, nanHead, true);\r\n\t\t\t\t\t\tthis.mem.setUint32(addr, 0, true);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.mem.setFloat64(addr, v, true);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (v === undefined) {\r\n\t\t\t\t\tthis.mem.setFloat64(addr, 0, true);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet id = this._ids.get(v);\r\n\t\t\t\tif (id === undefined) {\r\n\t\t\t\t\tid = this._idPool.pop();\r\n\t\t\t\t\tif (id === undefined) {\r\n\t\t\t\t\t\tid = this._values.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._values[id] = v;\r\n\t\t\t\t\tthis._goRefCounts[id] = 0;\r\n\t\t\t\t\tthis._ids.set(v, id);\r\n\t\t\t\t}\r\n\t\t\t\tthis._goRefCounts[id]++;\r\n\t\t\t\tlet typeFlag = 0;\r\n\t\t\t\tswitch (typeof v) {\r\n\t\t\t\t\tcase \"object\":\r\n\t\t\t\t\t\tif (v !== null) {\r\n\t\t\t\t\t\t\ttypeFlag = 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"string\":\r\n\t\t\t\t\t\ttypeFlag = 2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"symbol\":\r\n\t\t\t\t\t\ttypeFlag = 3;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"function\":\r\n\t\t\t\t\t\ttypeFlag = 4;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis.mem.setUint32(addr + 4, nanHead | typeFlag, true);\r\n\t\t\t\tthis.mem.setUint32(addr, id, true);\r\n\t\t\t}\r\n\r\n\t\t\tconst loadSlice = (addr) => {\r\n\t\t\t\tconst array = getInt64(addr + 0);\r\n\t\t\t\tconst len = getInt64(addr + 8);\r\n\t\t\t\treturn new Uint8Array(this._inst.exports.mem.buffer, array, len);\r\n\t\t\t}\r\n\r\n\t\t\tconst loadSliceOfValues = (addr) => {\r\n\t\t\t\tconst array = getInt64(addr + 0);\r\n\t\t\t\tconst len = getInt64(addr + 8);\r\n\t\t\t\tconst a = new Array(len);\r\n\t\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\t\ta[i] = loadValue(array + i * 8);\r\n\t\t\t\t}\r\n\t\t\t\treturn a;\r\n\t\t\t}\r\n\r\n\t\t\tconst loadString = (addr) => {\r\n\t\t\t\tconst saddr = getInt64(addr + 0);\r\n\t\t\t\tconst len = getInt64(addr + 8);\r\n\t\t\t\treturn decoder.decode(new DataView(this._inst.exports.mem.buffer, saddr, len));\r\n\t\t\t}\r\n\r\n\t\t\tconst timeOrigin = Date.now() - performance.now();\r\n\t\t\tthis.importObject = {\r\n\t\t\t\t_gotest: {\r\n\t\t\t\t\tadd: (a, b) => a + b,\r\n\t\t\t\t},\r\n\t\t\t\tgojs: {\r\n\t\t\t\t\t// Go's SP does not change as long as no Go code is running. Some operations (e.g. calls, getters and setters)\r\n\t\t\t\t\t// may synchronously trigger a Go event handler. This makes Go code get executed in the middle of the imported\r\n\t\t\t\t\t// function. A goroutine can switch to a new stack if the current stack is too small (see morestack function).\r\n\t\t\t\t\t// This changes the SP, thus we have to update the SP used by the imported function.\r\n\r\n\t\t\t\t\t// func wasmExit(code int32)\r\n\t\t\t\t\t\"runtime.wasmExit\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst code = this.mem.getInt32(sp + 8, true);\r\n\t\t\t\t\t\tthis.exited = true;\r\n\t\t\t\t\t\tdelete this._inst;\r\n\t\t\t\t\t\tdelete this._values;\r\n\t\t\t\t\t\tdelete this._goRefCounts;\r\n\t\t\t\t\t\tdelete this._ids;\r\n\t\t\t\t\t\tdelete this._idPool;\r\n\t\t\t\t\t\tthis.exit(code);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func wasmWrite(fd uintptr, p unsafe.Pointer, n int32)\r\n\t\t\t\t\t\"runtime.wasmWrite\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst fd = getInt64(sp + 8);\r\n\t\t\t\t\t\tconst p = getInt64(sp + 16);\r\n\t\t\t\t\t\tconst n = this.mem.getInt32(sp + 24, true);\r\n\t\t\t\t\t\twriteConsole(fd, new Uint8Array(this._inst.exports.mem.buffer, p, n));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func resetMemoryDataView()\r\n\t\t\t\t\t\"runtime.resetMemoryDataView\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tthis.mem = new DataView(this._inst.exports.mem.buffer);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func nanotime1() int64\r\n\t\t\t\t\t\"runtime.nanotime1\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tsetInt64(sp + 8, (timeOrigin + performance.now()) * 1000000);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func walltime() (sec int64, nsec int32)\r\n\t\t\t\t\t\"runtime.walltime\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst msec = (new Date).getTime();\r\n\t\t\t\t\t\tsetInt64(sp + 8, msec / 1000);\r\n\t\t\t\t\t\tthis.mem.setInt32(sp + 16, (msec % 1000) * 1000000, true);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func scheduleTimeoutEvent(delay int64) int32\r\n\t\t\t\t\t\"runtime.scheduleTimeoutEvent\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst id = this._nextCallbackTimeoutID;\r\n\t\t\t\t\t\tthis._nextCallbackTimeoutID++;\r\n\t\t\t\t\t\tthis._scheduledTimeouts.set(id, setTimeout(\r\n\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\tthis._resume();\r\n\t\t\t\t\t\t\t\twhile (this._scheduledTimeouts.has(id)) {\r\n\t\t\t\t\t\t\t\t\t// for some reason Go failed to register the timeout event, log and try again\r\n\t\t\t\t\t\t\t\t\t// (temporary workaround for https://github.com/golang/go/issues/28975)\r\n\t\t\t\t\t\t\t\t\tconsole.warn(\"scheduleTimeoutEvent: missed timeout event\");\r\n\t\t\t\t\t\t\t\t\tthis._resume();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tgetInt64(sp + 8),\r\n\t\t\t\t\t\t));\r\n\t\t\t\t\t\tthis.mem.setInt32(sp + 16, id, true);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func clearTimeoutEvent(id int32)\r\n\t\t\t\t\t\"runtime.clearTimeoutEvent\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst id = this.mem.getInt32(sp + 8, true);\r\n\t\t\t\t\t\tclearTimeout(this._scheduledTimeouts.get(id));\r\n\t\t\t\t\t\tthis._scheduledTimeouts.delete(id);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func getRandomData(r []byte)\r\n\t\t\t\t\t\"runtime.getRandomData\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tcrypto.getRandomValues(loadSlice(sp + 8));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func finalizeRef(v ref)\r\n\t\t\t\t\t\"syscall/js.finalizeRef\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst id = this.mem.getUint32(sp + 8, true);\r\n\t\t\t\t\t\tthis._goRefCounts[id]--;\r\n\t\t\t\t\t\tif (this._goRefCounts[id] === 0) {\r\n\t\t\t\t\t\t\tconst v = this._values[id];\r\n\t\t\t\t\t\t\tthis._values[id] = null;\r\n\t\t\t\t\t\t\tthis._ids.delete(v);\r\n\t\t\t\t\t\t\tthis._idPool.push(id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func stringVal(value string) ref\r\n\t\t\t\t\t\"syscall/js.stringVal\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tstoreValue(sp + 24, loadString(sp + 8));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueGet(v ref, p string) ref\r\n\t\t\t\t\t\"syscall/js.valueGet\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst result = Reflect.get(loadValue(sp + 8), loadString(sp + 16));\r\n\t\t\t\t\t\tsp = this._inst.exports.getsp() >>> 0; // see comment above\r\n\t\t\t\t\t\tstoreValue(sp + 32, result);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueSet(v ref, p string, x ref)\r\n\t\t\t\t\t\"syscall/js.valueSet\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tReflect.set(loadValue(sp + 8), loadString(sp + 16), loadValue(sp + 32));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueDelete(v ref, p string)\r\n\t\t\t\t\t\"syscall/js.valueDelete\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tReflect.deleteProperty(loadValue(sp + 8), loadString(sp + 16));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueIndex(v ref, i int) ref\r\n\t\t\t\t\t\"syscall/js.valueIndex\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tstoreValue(sp + 24, Reflect.get(loadValue(sp + 8), getInt64(sp + 16)));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// valueSetIndex(v ref, i int, x ref)\r\n\t\t\t\t\t\"syscall/js.valueSetIndex\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tReflect.set(loadValue(sp + 8), getInt64(sp + 16), loadValue(sp + 24));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueCall(v ref, m string, args []ref) (ref, bool)\r\n\t\t\t\t\t\"syscall/js.valueCall\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst v = loadValue(sp + 8);\r\n\t\t\t\t\t\t\tconst m = Reflect.get(v, loadString(sp + 16));\r\n\t\t\t\t\t\t\tconst args = loadSliceOfValues(sp + 32);\r\n\t\t\t\t\t\t\tconst result = Reflect.apply(m, v, args);\r\n\t\t\t\t\t\t\tsp = this._inst.exports.getsp() >>> 0; // see comment above\r\n\t\t\t\t\t\t\tstoreValue(sp + 56, result);\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 64, 1);\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tsp = this._inst.exports.getsp() >>> 0; // see comment above\r\n\t\t\t\t\t\t\tstoreValue(sp + 56, err);\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 64, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueInvoke(v ref, args []ref) (ref, bool)\r\n\t\t\t\t\t\"syscall/js.valueInvoke\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst v = loadValue(sp + 8);\r\n\t\t\t\t\t\t\tconst args = loadSliceOfValues(sp + 16);\r\n\t\t\t\t\t\t\tconst result = Reflect.apply(v, undefined, args);\r\n\t\t\t\t\t\t\tsp = this._inst.exports.getsp() >>> 0; // see comment above\r\n\t\t\t\t\t\t\tstoreValue(sp + 40, result);\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tsp = this._inst.exports.getsp() >>> 0; // see comment above\r\n\t\t\t\t\t\t\tstoreValue(sp + 40, err);\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueNew(v ref, args []ref) (ref, bool)\r\n\t\t\t\t\t\"syscall/js.valueNew\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst v = loadValue(sp + 8);\r\n\t\t\t\t\t\t\tconst args = loadSliceOfValues(sp + 16);\r\n\t\t\t\t\t\t\tconst result = Reflect.construct(v, args);\r\n\t\t\t\t\t\t\tsp = this._inst.exports.getsp() >>> 0; // see comment above\r\n\t\t\t\t\t\t\tstoreValue(sp + 40, result);\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tsp = this._inst.exports.getsp() >>> 0; // see comment above\r\n\t\t\t\t\t\t\tstoreValue(sp + 40, err);\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueLength(v ref) int\r\n\t\t\t\t\t\"syscall/js.valueLength\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tsetInt64(sp + 16, parseInt(loadValue(sp + 8).length));\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// valuePrepareString(v ref) (ref, int)\r\n\t\t\t\t\t\"syscall/js.valuePrepareString\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst str = encoder.encode(String(loadValue(sp + 8)));\r\n\t\t\t\t\t\tstoreValue(sp + 16, str);\r\n\t\t\t\t\t\tsetInt64(sp + 24, str.length);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// valueLoadString(v ref, b []byte)\r\n\t\t\t\t\t\"syscall/js.valueLoadString\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst str = loadValue(sp + 8);\r\n\t\t\t\t\t\tloadSlice(sp + 16).set(str);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func valueInstanceOf(v ref, t ref) bool\r\n\t\t\t\t\t\"syscall/js.valueInstanceOf\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tthis.mem.setUint8(sp + 24, (loadValue(sp + 8) instanceof loadValue(sp + 16)) ? 1 : 0);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func copyBytesToGo(dst []byte, src ref) (int, bool)\r\n\t\t\t\t\t\"syscall/js.copyBytesToGo\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst dst = loadSlice(sp + 8);\r\n\t\t\t\t\t\tconst src = loadValue(sp + 32);\r\n\t\t\t\t\t\tif (!(src instanceof Uint8Array || src instanceof Uint8ClampedArray)) {\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst toCopy = src.subarray(0, dst.length);\r\n\t\t\t\t\t\tdst.set(toCopy);\r\n\t\t\t\t\t\tsetInt64(sp + 40, toCopy.length);\r\n\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t// func copyBytesToJS(dst ref, src []byte) (int, bool)\r\n\t\t\t\t\t\"syscall/js.copyBytesToJS\": (sp) => {\r\n\t\t\t\t\t\tsp >>>= 0;\r\n\t\t\t\t\t\tconst dst = loadValue(sp + 8);\r\n\t\t\t\t\t\tconst src = loadSlice(sp + 16);\r\n\t\t\t\t\t\tif (!(dst instanceof Uint8Array || dst instanceof Uint8ClampedArray)) {\r\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst toCopy = src.subarray(0, dst.length);\r\n\t\t\t\t\t\tdst.set(toCopy);\r\n\t\t\t\t\t\tsetInt64(sp + 40, toCopy.length);\r\n\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\"debug\": (value) => {\r\n\t\t\t\t\t\tconsole.log(value);\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tasync run(instance) {\r\n\t\t\tif (!(instance instanceof WebAssembly.Instance)) {\r\n\t\t\t\tthrow new Error(\"Go.run: WebAssembly.Instance expected\");\r\n\t\t\t}\r\n\t\t\tthis._inst = instance;\r\n\t\t\tthis.mem = new DataView(this._inst.exports.mem.buffer);\r\n\t\t\tthis._values = [ // JS values that Go currently has references to, indexed by reference id\r\n\t\t\t\tNaN,\r\n\t\t\t\t0,\r\n\t\t\t\tnull,\r\n\t\t\t\ttrue,\r\n\t\t\t\tfalse,\r\n\t\t\t\tglobalThis,\r\n\t\t\t\tthis,\r\n\t\t\t];\r\n\t\t\tthis._goRefCounts = new Array(this._values.length).fill(Infinity); // number of references that Go has to a JS value, indexed by reference id\r\n\t\t\tthis._ids = new Map([ // mapping from JS values to reference ids\r\n\t\t\t\t[0, 1],\r\n\t\t\t\t[null, 2],\r\n\t\t\t\t[true, 3],\r\n\t\t\t\t[false, 4],\r\n\t\t\t\t[globalThis, 5],\r\n\t\t\t\t[this, 6],\r\n\t\t\t]);\r\n\t\t\tthis._idPool = [];   // unused ids that have been garbage collected\r\n\t\t\tthis.exited = false; // whether the Go program has exited\r\n\r\n\t\t\t// Pass command line arguments and environment variables to WebAssembly by writing them to the linear memory.\r\n\t\t\tlet offset = 4096;\r\n\r\n\t\t\tconst strPtr = (str) => {\r\n\t\t\t\tconst ptr = offset;\r\n\t\t\t\tconst bytes = encoder.encode(str + \"\\0\");\r\n\t\t\t\tnew Uint8Array(this.mem.buffer, offset, bytes.length).set(bytes);\r\n\t\t\t\toffset += bytes.length;\r\n\t\t\t\tif (offset % 8 !== 0) {\r\n\t\t\t\t\toffset += 8 - (offset % 8);\r\n\t\t\t\t}\r\n\t\t\t\treturn ptr;\r\n\t\t\t};\r\n\r\n\t\t\tconst argc = this.argv.length;\r\n\r\n\t\t\tconst argvPtrs = [];\r\n\t\t\tthis.argv.forEach((arg) => {\r\n\t\t\t\targvPtrs.push(strPtr(arg));\r\n\t\t\t});\r\n\t\t\targvPtrs.push(0);\r\n\r\n\t\t\tconst keys = Object.keys(this.env).sort();\r\n\t\t\tkeys.forEach((key) => {\r\n\t\t\t\targvPtrs.push(strPtr(`${key}=${this.env[key]}`));\r\n\t\t\t});\r\n\t\t\targvPtrs.push(0);\r\n\r\n\t\t\tconst argv = offset;\r\n\t\t\targvPtrs.forEach((ptr) => {\r\n\t\t\t\tthis.mem.setUint32(offset, ptr, true);\r\n\t\t\t\tthis.mem.setUint32(offset + 4, 0, true);\r\n\t\t\t\toffset += 8;\r\n\t\t\t});\r\n\r\n\t\t\t// The linker guarantees global data starts from at least wasmMinDataAddr.\r\n\t\t\t// Keep in sync with cmd/link/internal/ld/data.go:wasmMinDataAddr.\r\n\t\t\tconst wasmMinDataAddr = 4096 + 8192;\r\n\t\t\tif (offset >= wasmMinDataAddr) {\r\n\t\t\t\tthrow new Error(\"total length of command line and environment variables exceeds limit\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._inst.exports.run(argc, argv);\r\n\t\t\tif (this.exited) {\r\n\t\t\t\tthis._resolveExitPromise();\r\n\t\t\t}\r\n\t\t\tawait this._exitPromise;\r\n\t\t}\r\n\r\n\t\t_resume() {\r\n\t\t\tif (this.exited) {\r\n\t\t\t\tthrow new Error(\"Go program has already exited\");\r\n\t\t\t}\r\n\t\t\tthis._inst.exports.resume();\r\n\t\t\tif (this.exited) {\r\n\t\t\t\tthis._resolveExitPromise();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_makeFuncWrapper(id) {\r\n\t\t\tconst go = this;\r\n\t\t\treturn function () {\r\n\t\t\t\tconst event = { id: id, this: this, args: arguments };\r\n\t\t\t\tgo._pendingEvent = event;\r\n\t\t\t\tgo._resume();\r\n\t\t\t\treturn event.result;\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n})();\r\n"

// BrowsferFSJS is the browserfs.js file for the current version of Go.
BrowserFSJS = "var BrowserFS=(()=>{var Nt=Object.defineProperty,xi=Object.defineProperties,vi=Object.getOwnPropertyDescriptor,Ei=Object.getOwnPropertyDescriptors,_i=Object.getOwnPropertyNames,He=Object.getOwnPropertySymbols,Ci=Object.getPrototypeOf,Qe=Object.prototype.hasOwnProperty,ki=Object.prototype.propertyIsEnumerable,Oi=Reflect.get;var le=Math.pow,Ge=(r,e,t)=>e in r?Nt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,X=(r,e)=>{for(var t in e||(e={}))Qe.call(e,t)&&Ge(r,t,e[t]);if(He)for(var t of He(e))ki.call(e,t)&&Ge(r,t,e[t]);return r},G=(r,e)=>xi(r,Ei(e)),a=(r,e)=>Nt(r,\"name\",{value:e,configurable:!0});var zt=(r,e)=>{for(var t in e)Nt(r,t,{get:e[t],enumerable:!0})},Ti=(r,e,t,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let n of _i(e))!Qe.call(r,n)&&n!==t&&Nt(r,n,{get:()=>e[n],enumerable:!(i=vi(e,n))||i.enumerable});return r};var Ni=r=>Ti(Nt({},\"__esModule\",{value:!0}),r);var Ze=(r,e,t)=>Oi(Ci(r),t,e);var u=(r,e,t)=>new Promise((i,n)=>{var s=d=>{try{l(t.next(d))}catch(m){n(m)}},o=d=>{try{l(t.throw(d))}catch(m){n(m)}},l=d=>d.done?i(d.value):Promise.resolve(d.value).then(s,o);l((t=t.apply(r,e)).next())});var Ln={};zt(Ln,{ActionType:()=>Jt,ApiError:()=>c,AsyncKeyValueFile:()=>Ot,AsyncKeyValueFileSystem:()=>ce,AsyncMirror:()=>et,BaseFile:()=>At,BaseFileSystem:()=>j,Cred:()=>E,ErrorCode:()=>D,ErrorStrings:()=>A,FileFlag:()=>w,FileIndex:()=>Tt,FileSystem:()=>ct,FileType:()=>_,FolderAdapter:()=>q,InMemory:()=>$,IndexDirInode:()=>rt,IndexFileInode:()=>Bt,NoSyncFile:()=>Xt,OverlayFS:()=>Z,PreloadFile:()=>M,ROOT_NODE_ID:()=>W,SimpleSyncRWTransaction:()=>vt,Stats:()=>k,SyncKeyValueFile:()=>Et,SyncKeyValueFileSystem:()=>_t,SynchronousFileSystem:()=>lt,backends:()=>oe,checkOptions:()=>de,configure:()=>Un,decode:()=>B,default:()=>Rn,encode:()=>S,fs:()=>re,getFileSystem:()=>Fi,initialize:()=>wi,isIndexDirInode:()=>Xe,isIndexFileInode:()=>bi,mkdirpSync:()=>ni,randomUUID:()=>ht,registerBackend:()=>yi,setImmediate:()=>Ri,toPromise:()=>Ui,wait:()=>Di});var $e={};zt($e,{_toUnixTimestamp:()=>oi,access:()=>Gr,accessSync:()=>Pn,appendFile:()=>kr,appendFileSync:()=>ln,chmod:()=>Yr,chmodSync:()=>On,chown:()=>jr,chownSync:()=>Cn,close:()=>Tr,closeSync:()=>dn,constants:()=>Ft,createReadStream:()=>en,createWriteStream:()=>rn,exists:()=>Sr,existsSync:()=>ui,fchmod:()=>Rr,fchmodSync:()=>bn,fchown:()=>Ur,fchownSync:()=>yn,fdatasync:()=>Pr,fdatasyncSync:()=>hn,fstat:()=>Or,fstatSync:()=>un,fsync:()=>Ar,fsyncSync:()=>fn,ftruncate:()=>Nr,ftruncateSync:()=>mn,futimes:()=>Lr,futimesSync:()=>Sn,getMount:()=>xt,getMounts:()=>ci,initialize:()=>li,lchmod:()=>Xr,lchmodSync:()=>Tn,lchown:()=>$r,lchownSync:()=>kn,link:()=>Vr,linkSync:()=>vn,lstat:()=>Fr,lstatSync:()=>on,lutimes:()=>qr,lutimesSync:()=>An,mkdir:()=>Mr,mkdirSync:()=>Fn,mount:()=>Gt,open:()=>Er,openSync:()=>cn,promises:()=>It,read:()=>Dr,readFile:()=>_r,readFileSync:()=>mi,readSync:()=>gn,readdir:()=>zr,readdirSync:()=>xn,readlink:()=>Kr,readlinkSync:()=>_n,realpath:()=>Hr,realpathSync:()=>je,rename:()=>br,renameSync:()=>nn,rmdir:()=>Br,rmdirSync:()=>wn,stat:()=>wr,statSync:()=>sn,symlink:()=>Wr,symlinkSync:()=>En,truncate:()=>xr,truncateSync:()=>an,umount:()=>pe,unlink:()=>vr,unlinkSync:()=>di,unwatchFile:()=>Zr,utimes:()=>Jr,utimesSync:()=>Nn,watch:()=>tn,watchFile:()=>Qr,write:()=>Ir,writeFile:()=>Cr,writeFileSync:()=>fi,writeSync:()=>pn});var Ai=\"/\",ft=\"/\";function nt(r,e){if(typeof r!=\"string\")throw new TypeError(`\"${e}\" is not a string`)}a(nt,\"validateString\");function ti(r,e){let t=\"\",i=0,n=-1,s=0,o=\"\\0\";for(let l=0;l<=r.length;++l){if(l<r.length)o=r[l];else{if(o==\"/\")break;o=\"/\"}if(o==\"/\"){if(!(n===l-1||s===1))if(s===2){if(t.length<2||i!==2||t.at(-1)!==\".\"||t.at(-2)!==\".\"){if(t.length>2){let d=t.lastIndexOf(\"/\");d===-1?(t=\"\",i=0):(t=t.slice(0,d),i=t.length-1-t.lastIndexOf(\"/\")),n=l,s=0;continue}else if(t.length!==0){t=\"\",i=0,n=l,s=0;continue}}e&&(t+=t.length>0?\"/..\":\"..\",i=2)}else t.length>0?t+=\"/\"+r.slice(n+1,l):t=r.slice(n+1,l),i=l-n-1;n=l,s=0}else o===\".\"&&s!==-1?++s:s=-1}return t}a(ti,\"normalizeString\");function P(...r){let e=\"\",t=!1;for(let i=r.length-1;i>=-1&&!t;i--){let n=i>=0?r[i]:Ai;nt(n,`paths[${i}]`),n.length!==0&&(e=`${n}/${e}`,t=n[0]===\"/\")}return e=ti(e,!t),t?`/${e}`:e.length>0?e:\".\"}a(P,\"resolve\");function Pi(r){if(nt(r,\"path\"),r.length===0)return\".\";let e=r[0]===\"/\",t=r.at(-1)===\"/\";return r=ti(r,!e),r.length===0?e?\"/\":t?\"./\":\".\":(t&&(r+=\"/\"),e?`/${r}`:r)}a(Pi,\"normalize\");function U(...r){if(r.length===0)return\".\";let e;for(let t=0;t<r.length;++t){let i=r[t];nt(i,\"path\"),i.length>0&&(e===void 0?e=i:e+=`/${i}`)}return e===void 0?\".\":Pi(e)}a(U,\"join\");function ei(r,e){if(nt(r,\"from\"),nt(e,\"to\"),r===e||(r=P(r),e=P(e),r===e))return\"\";let t=1,i=r.length,n=i-t,s=1,o=e.length-s,l=n<o?n:o,d=-1,m=0;for(;m<l;m++){let h=r[t+m];if(h!==e[s+m])break;h===\"/\"&&(d=m)}if(m===l)if(o>l){if(e[s+m]===\"/\")return e.slice(s+m+1);if(m===0)return e.slice(s+m)}else n>l&&(r[t+m]===\"/\"?d=m:m===0&&(d=0));let f=\"\";for(m=t+d+1;m<=i;++m)(m===i||r[m]===\"/\")&&(f+=f.length===0?\"..\":\"/..\");return`${f}${e.slice(s+d)}`}a(ei,\"relative\");function F(r){if(nt(r,\"path\"),r.length===0)return\".\";let e=r[0]===\"/\",t=-1,i=!0;for(let n=r.length-1;n>=1;--n)if(r[n]===\"/\"){if(!i){t=n;break}}else i=!1;return t===-1?e?\"/\":\".\":e&&t===1?\"//\":r.slice(0,t)}a(F,\"dirname\");function I(r,e){e!==void 0&&nt(e,\"ext\"),nt(r,\"path\");let t=0,i=-1,n=!0;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return\"\";let s=e.length-1,o=-1;for(let l=r.length-1;l>=0;--l)if(r[l]===\"/\"){if(!n){t=l+1;break}}else o===-1&&(n=!1,o=l+1),s>=0&&(r[l]===e[s]?--s===-1&&(i=l):(s=-1,i=o));return t===i?i=o:i===-1&&(i=r.length),r.slice(t,i)}for(let s=r.length-1;s>=0;--s)if(r[s]===\"/\"){if(!n){t=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?\"\":r.slice(t,i)}a(I,\"basename\");function ni(r,e,t,i){i.existsSync(r,t)||(ni(F(r),e,t,i),i.mkdirSync(r,e,t))}a(ni,\"mkdirpSync\");function Vt(r,e,t,i,n){return Math.min(r+1,e+1,t+1,i===n?e:e+1)}a(Vt,\"_min\");function Ii(r,e){if(r===e)return 0;r.length>e.length&&([r,e]=[e,r]);let t=r.length,i=e.length;for(;t>0&&r.charCodeAt(t-1)===e.charCodeAt(i-1);)t--,i--;let n=0;for(;n<t&&r.charCodeAt(n)===e.charCodeAt(n);)n++;if(t-=n,i-=n,t===0||i===1)return i;let s=new Array(t<<1);for(let y=0;y<t;)s[t+y]=r.charCodeAt(n+y),s[y]=++y;let o,l,d,m,f;for(o=0;o+3<i;){let y=e.charCodeAt(n+(l=o)),v=e.charCodeAt(n+(d=o+1)),x=e.charCodeAt(n+(m=o+2)),g=e.charCodeAt(n+(f=o+3)),H=o+=4;for(let gt=0;gt<t;){let Mt=s[t+gt],qe=s[gt];l=Vt(qe,l,d,y,Mt),d=Vt(l,d,m,v,Mt),m=Vt(d,m,f,x,Mt),H=Vt(m,f,H,g,Mt),s[gt++]=H,f=m,m=d,d=l,l=qe}}let h=0;for(;o<i;){let y=e.charCodeAt(n+(l=o));h=++o;for(let v=0;v<t;v++){let x=s[v];s[v]=h=x<l||h<l?x>h?h+1:x+1:y===s[t+v]?l:l+1,l=x}}return h}a(Ii,\"levenshtein\");function de(r,e){return u(this,null,function*(){let t=r.Options,i=r.Name,n=0,s=!1,o=!1;for(let l in t)if(Object.prototype.hasOwnProperty.call(t,l)){let d=t[l],m=e&&e[l];if(m==null){if(!d.optional){let f=Object.keys(e).filter(h=>!(h in t)).map(h=>({str:h,distance:Ii(l,h)})).filter(h=>h.distance<5).sort((h,y)=>h.distance-y.distance);if(s)return;throw s=!0,new c(22,`[${i}] Required option '${l}' not provided.${f.length>0?` You provided unrecognized option '${f[0].str}'; perhaps you meant to type '${l}'.`:\"\"}\nOption description: ${d.description}`)}}else{let f=!1;if(Array.isArray(d.type)?f=d.type.indexOf(typeof m)!==-1:f=typeof m===d.type,f){if(d.validator){n++;try{yield d.validator(m)}catch(h){if(!s){if(h)throw s=!0,h;if(n--,n===0&&o)return}}}}else{if(s)return;throw s=!0,new c(22,`[${i}] Value provided for option ${l} is not the proper type. Expected ${Array.isArray(d.type)?`one of {${d.type.join(\", \")}}`:d.type}, but received ${typeof m}\nOption description: ${d.description}`)}}}o=!0})}a(de,\"checkOptions\");function Di(r){return new Promise(e=>{setTimeout(e,r)})}a(Di,\"wait\");function Ui(r){return function(...e){return new Promise((t,i)=>{e.push((n,...s)=>{n?i(n):t(s[0])}),r(...e)})}}a(Ui,\"toPromise\");var Ri=typeof globalThis.setImmediate==\"function\"?globalThis.setImmediate:r=>setTimeout(r,0),W=\"/\",ii=new globalThis.TextEncoder,S=ii.encode.bind(ii),ri=new globalThis.TextDecoder,B=ri.decode.bind(ri);function ht(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(r){let e=Math.random()*16|0;return(r===\"x\"?e:e&3|8).toString(16)})}a(ht,\"randomUUID\");var D=(g=>(g[g.EPERM=1]=\"EPERM\",g[g.ENOENT=2]=\"ENOENT\",g[g.EIO=5]=\"EIO\",g[g.EBADF=9]=\"EBADF\",g[g.EACCES=13]=\"EACCES\",g[g.EBUSY=16]=\"EBUSY\",g[g.EEXIST=17]=\"EEXIST\",g[g.ENOTDIR=20]=\"ENOTDIR\",g[g.EISDIR=21]=\"EISDIR\",g[g.EINVAL=22]=\"EINVAL\",g[g.EFBIG=27]=\"EFBIG\",g[g.ENOSPC=28]=\"ENOSPC\",g[g.EROFS=30]=\"EROFS\",g[g.ENOTEMPTY=39]=\"ENOTEMPTY\",g[g.ENOTSUP=95]=\"ENOTSUP\",g))(D||{}),A={};A[1]=\"Operation not permitted.\";A[2]=\"No such file or directory.\";A[5]=\"Input/output error.\";A[9]=\"Bad file descriptor.\";A[13]=\"Permission denied.\";A[16]=\"Resource busy or locked.\";A[17]=\"File exists.\";A[20]=\"File is not a directory.\";A[21]=\"File is a directory.\";A[22]=\"Invalid argument.\";A[27]=\"File is too big.\";A[28]=\"No space left on disk.\";A[30]=\"Cannot modify a read-only file system.\";A[39]=\"Directory is not empty.\";A[95]=\"Operation is not supported.\";var c=class extends Error{constructor(t,i=A[t],n){super(i);this.syscall=\"\";this.errno=t,this.code=D[t],this.path=n,this.message=`Error: ${this.code}: ${i}${this.path?`, '${this.path}'`:\"\"}`}static fromJSON(t){let i=new c(t.errno,t.message,t.path);return i.code=t.code,i.stack=t.stack,i}static Derserialize(t,i=0){let n=new DataView(\"buffer\"in t?t.buffer:t),s=B(n.buffer.slice(i+4,i+4+n.getUint32(i,!0)));return c.fromJSON(JSON.parse(s))}static FileError(t,i){return new c(t,A[t],i)}static EACCES(t){return this.FileError(13,t)}static ENOENT(t){return this.FileError(2,t)}static EEXIST(t){return this.FileError(17,t)}static EISDIR(t){return this.FileError(21,t)}static ENOTDIR(t){return this.FileError(20,t)}static EPERM(t){return this.FileError(1,t)}static ENOTEMPTY(t){return this.FileError(39,t)}toString(){return this.message}toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}}serialize(t=new Uint8Array(this.bufferSize()),i=0){let n=new DataView(\"buffer\"in t?t.buffer:t),s=new Uint8Array(n.buffer),o=S(JSON.stringify(this.toJSON()));return s.set(o),n.setUint32(i,o.byteLength,!0),s}bufferSize(){return 4+JSON.stringify(this.toJSON()).length}};a(c,\"ApiError\");var me=class{constructor(e,t,i,n,s,o){this.uid=e;this.gid=t;this.suid=i;this.sgid=n;this.euid=s;this.egid=o}},E=me;a(E,\"Cred\"),E.Root=new me(0,0,0,0,0,0);var Ft={};zt(Ft,{COPYFILE_EXCL:()=>Mi,COPYFILE_FICLONE:()=>zi,COPYFILE_FICLONE_FORCE:()=>Vi,F_OK:()=>Li,O_APPEND:()=>wt,O_CREAT:()=>Q,O_DIRECT:()=>Ji,O_DIRECTORY:()=>Ki,O_DSYNC:()=>Yi,O_EXCL:()=>bt,O_NOATIME:()=>ji,O_NOCTTY:()=>Wi,O_NOFOLLOW:()=>$i,O_NONBLOCK:()=>qi,O_RDONLY:()=>Wt,O_RDWR:()=>ot,O_SYMLINK:()=>Xi,O_SYNC:()=>Kt,O_TRUNC:()=>St,O_WRONLY:()=>yt,R_OK:()=>tt,S_IFBLK:()=>Gi,S_IFCHR:()=>Hi,S_IFDIR:()=>$t,S_IFIFO:()=>Qi,S_IFLNK:()=>Yt,S_IFMT:()=>K,S_IFREG:()=>jt,S_IFSOCK:()=>Zi,S_IRGRP:()=>sr,S_IROTH:()=>lr,S_IRUSR:()=>er,S_IRWXG:()=>nr,S_IRWXO:()=>cr,S_IRWXU:()=>tr,S_IWGRP:()=>or,S_IWOTH:()=>ur,S_IWUSR:()=>ir,S_IXGRP:()=>ar,S_IXOTH:()=>dr,S_IXUSR:()=>rr,W_OK:()=>st,X_OK:()=>Bi});var Li=0,tt=4,st=2,Bi=1,Mi=1,zi=2,Vi=4,Wt=0,yt=1,ot=2,Q=64,bt=128,Wi=256,St=512,wt=1024,Ki=65536,ji=262144,$i=131072,Kt=1052672,Yi=4096,Xi=32768,Ji=16384,qi=2048,K=61440,jt=32768,$t=16384,Hi=8192,Gi=24576,Qi=4096,Yt=40960,Zi=49152,tr=448,er=256,ir=128,rr=64,nr=56,sr=32,or=16,ar=8,cr=7,lr=4,ur=2,dr=1;var _=(i=>(i[i.FILE=32768]=\"FILE\",i[i.DIRECTORY=16384]=\"DIRECTORY\",i[i.SYMLINK=40960]=\"SYMLINK\",i))(_||{}),k=class{constructor(e,t,i,n,s,o,l,d,m){this.dev=0;this.ino=0;this.rdev=0;this.nlink=1;this.blksize=4096;this.uid=0;this.gid=0;this.fileData=null;this.size=t;let f=0;if(typeof n!=\"number\"&&(f=Date.now(),n=f),typeof s!=\"number\"&&(f||(f=Date.now()),s=f),typeof o!=\"number\"&&(f||(f=Date.now()),o=f),typeof m!=\"number\"&&(f||(f=Date.now()),m=f),typeof l!=\"number\"&&(l=0),typeof d!=\"number\"&&(d=0),this.atimeMs=n,this.ctimeMs=o,this.mtimeMs=s,this.birthtimeMs=m,i)this.mode=i;else switch(e){case _.FILE:this.mode=420;break;case _.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(t/512),this.mode&61440||(this.mode|=e)}static Deserialize(e){let t=new DataView(\"buffer\"in e?e.buffer:e),i=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getFloat64(8,!0),o=t.getFloat64(16,!0),l=t.getFloat64(24,!0),d=t.getUint32(32,!0),m=t.getUint32(36,!0);return new k(n&61440,i,n&-61441,s,o,l,d,m)}static clone(e){return new k(e.mode&61440,e.size,e.mode&-61441,e.atimeMs,e.mtimeMs,e.ctimeMs,e.uid,e.gid,e.birthtimeMs)}get atime(){return new Date(this.atimeMs)}get mtime(){return new Date(this.mtimeMs)}get ctime(){return new Date(this.ctimeMs)}get birthtime(){return new Date(this.birthtimeMs)}serialize(){let e=new Uint8Array(32),t=new DataView(e.buffer);return t.setUint32(0,this.size,!0),t.setUint32(4,this.mode,!0),t.setFloat64(8,this.atime.getTime(),!0),t.setFloat64(16,this.mtime.getTime(),!0),t.setFloat64(24,this.ctime.getTime(),!0),t.setUint32(32,this.uid,!0),t.setUint32(36,this.gid,!0),e}isFile(){return(this.mode&61440)===32768}isDirectory(){return(this.mode&61440)===16384}isSymbolicLink(){return(this.mode&61440)===40960}hasAccess(e,t){if(t.euid===0||t.egid===0)return!0;let i=this.mode&-61441,n=15,s=15,o=15;if(t.euid==this.uid){let m=(3840&i)>>8;n=(e^m)&e}if(t.egid==this.gid){let m=(240&i)>>4;s=(e^m)&e}let l=15&i;return o=(e^l)&e,!(n&s&o)}getCred(e=this.uid,t=this.gid){return new E(e,t,this.uid,this.gid,e,t)}chmod(e){this.mode=this.mode&61440|e}chown(e,t){!isNaN(+e)&&0<=+e&&+e<le(2,32)&&(this.uid=e),!isNaN(+t)&&0<=+t&&+t<le(2,32)&&(this.gid=t)}isSocket(){return!1}isBlockDevice(){return!1}isCharacterDevice(){return!1}isFIFO(){return!1}};a(k,\"Stats\");var Jt=(n=>(n[n.NOP=0]=\"NOP\",n[n.THROW_EXCEPTION=1]=\"THROW_EXCEPTION\",n[n.TRUNCATE_FILE=2]=\"TRUNCATE_FILE\",n[n.CREATE_FILE=3]=\"CREATE_FILE\",n))(Jt||{}),at=class{static getFileFlag(e){return at.flagCache.has(e)||at.flagCache.set(e,new at(e)),at.flagCache.get(e)}constructor(e){if(typeof e==\"string\"){if(this.flagStr=e,at.validFlagStrs.indexOf(e)<0)throw new c(22,\"Invalid flag string: \"+e)}else this.flagStr=at.stringFromNumber(e)}static stringFromNumber(e){switch(e){case 0:return\"r\";case 1052672:return\"rs\";case 2:return\"r+\";case 1052674:return\"rs+\";case 577:return\"w\";case 705:return\"wx\";case 578:return\"w+\";case 706:return\"wx+\";case 1089:return\"a\";case 1217:return\"ax\";case 1090:return\"a+\";case 1218:return\"ax+\";default:throw new c(22,\"Invalid flag number: \"+e)}}getFlagString(){return this.flagStr}getMode(){let e=0;return e<<=1,e+=+this.isReadable(),e<<=1,e+=+this.isWriteable(),e<<=1,e}isReadable(){return this.flagStr.indexOf(\"r\")!==-1||this.flagStr.indexOf(\"+\")!==-1}isWriteable(){return this.flagStr.indexOf(\"w\")!==-1||this.flagStr.indexOf(\"a\")!==-1||this.flagStr.indexOf(\"+\")!==-1}isTruncating(){return this.flagStr.indexOf(\"w\")!==-1}isAppendable(){return this.flagStr.indexOf(\"a\")!==-1}isSynchronous(){return this.flagStr.indexOf(\"s\")!==-1}isExclusive(){return this.flagStr.indexOf(\"x\")!==-1}pathExistsAction(){return this.isExclusive()?1:this.isTruncating()?2:0}pathNotExistsAction(){return(this.isWriteable()||this.isAppendable())&&this.flagStr!==\"r+\"?3:1}},w=at;a(w,\"FileFlag\"),w.flagCache=new Map,w.validFlagStrs=[\"r\",\"r+\",\"rs\",\"rs+\",\"w\",\"wx\",\"w+\",\"wx+\",\"a\",\"ax\",\"a+\",\"ax+\"];var At=class{sync(){return u(this,null,function*(){throw new c(95)})}syncSync(){throw new c(95)}datasync(){return u(this,null,function*(){return this.sync()})}datasyncSync(){return this.syncSync()}chown(e,t){return u(this,null,function*(){throw new c(95)})}chownSync(e,t){throw new c(95)}chmod(e){return u(this,null,function*(){throw new c(95)})}chmodSync(e){throw new c(95)}utimes(e,t){return u(this,null,function*(){throw new c(95)})}utimesSync(e,t){throw new c(95)}};a(At,\"BaseFile\");var M=class extends At{constructor(t,i,n,s,o){super();this._pos=0;this._dirty=!1;if(this._fs=t,this._path=i,this._flag=n,this._stat=s,this._buffer=o||new Uint8Array(0),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error(`Invalid buffer: Uint8Array is ${this._buffer.length} long, yet Stats object specifies that file is ${this._stat.size} long.`)}getBuffer(){return this._buffer}getStats(){return this._stat}getFlag(){return this._flag}getPath(){return this._path}getPos(){return this._flag.isAppendable()?this._stat.size:this._pos}advancePos(t){return this._pos+=t}setPos(t){return this._pos=t}sync(){return u(this,null,function*(){this.syncSync()})}syncSync(){throw new c(95)}close(){return u(this,null,function*(){this.closeSync()})}closeSync(){throw new c(95)}stat(){return u(this,null,function*(){return k.clone(this._stat)})}statSync(){return k.clone(this._stat)}truncate(t){if(this.truncateSync(t),this._flag.isSynchronous()&&!xt(\"/\").metadata.synchronous)return this.sync()}truncateSync(t){if(this._dirty=!0,!this._flag.isWriteable())throw new c(1,\"File not opened with a writeable mode.\");if(this._stat.mtimeMs=Date.now(),t>this._buffer.length){let i=new Uint8Array(t-this._buffer.length);this.writeSync(i,0,i.length,this._buffer.length),this._flag.isSynchronous()&&xt(\"/\").metadata.synchronous&&this.syncSync();return}this._stat.size=t,this._buffer=this._buffer.subarray(0,t),this._flag.isSynchronous()&&xt(\"/\").metadata.synchronous&&this.syncSync()}write(t,i,n,s){return u(this,null,function*(){return this.writeSync(t,i,n,s)})}writeSync(t,i,n,s){if(this._dirty=!0,s==null&&(s=this.getPos()),!this._flag.isWriteable())throw new c(1,\"File not opened with a writeable mode.\");let o=s+n;if(o>this._stat.size&&(this._stat.size=o,o>this._buffer.length)){let d=new Uint8Array(o);d.set(this._buffer),this._buffer=d}this._buffer.set(t.slice(i,i+n),s);let l=this._buffer.length;return this._stat.mtimeMs=Date.now(),this._flag.isSynchronous()?(this.syncSync(),l):(this.setPos(s+l),l)}read(t,i,n,s){return u(this,null,function*(){return{bytesRead:this.readSync(t,i,n,s),buffer:t}})}readSync(t,i,n,s){if(!this._flag.isReadable())throw new c(1,\"File not opened with a readable mode.\");return s==null&&(s=this.getPos()),s+n>this._stat.size&&(n=this._stat.size-s),this._buffer.set(t.slice(i,i+n),s),this._stat.atimeMs=Date.now(),this._pos=s+n,this._buffer.length}chmod(t){return u(this,null,function*(){this.chmodSync(t)})}chmodSync(t){if(!this._fs.metadata.supportsProperties)throw new c(95);this._dirty=!0,this._stat.chmod(t),this.syncSync()}chown(t,i){return u(this,null,function*(){this.chownSync(t,i)})}chownSync(t,i){if(!this._fs.metadata.supportsProperties)throw new c(95);this._dirty=!0,this._stat.chown(t,i),this.syncSync()}isDirty(){return this._dirty}resetDirty(){this._dirty=!1}};a(M,\"PreloadFile\");var Xt=class extends M{constructor(e,t,i,n,s){super(e,t,i,n,s)}sync(){return u(this,null,function*(){})}syncSync(){}close(){return u(this,null,function*(){})}closeSync(){}};a(Xt,\"NoSyncFile\");var ct=class{constructor(e){}};a(ct,\"FileSystem\");var fe=class extends ct{constructor(t){super();this._ready=Promise.resolve(this)}get metadata(){return{name:this.constructor.name,readonly:!1,synchronous:!1,supportsProperties:!1,supportsLinks:!1,totalSpace:0,freeSpace:0}}whenReady(){return this._ready}openFile(t,i,n){return u(this,null,function*(){throw new c(95)})}createFile(t,i,n,s){return u(this,null,function*(){throw new c(95)})}open(t,i,n,s){return u(this,null,function*(){try{let o=yield this.stat(t,s);switch(i.pathExistsAction()){case 1:throw c.EEXIST(t);case 2:let l=yield this.openFile(t,i,s);if(!l)throw new Error(\"BFS has reached an impossible code path; please file a bug.\");return yield l.truncate(0),yield l.sync(),l;case 0:return this.openFile(t,i,s);default:throw new c(22,\"Invalid FileFlag object.\")}}catch(o){switch(i.pathNotExistsAction()){case 3:let l=yield this.stat(F(t),s);if(l&&!l.isDirectory())throw c.ENOTDIR(F(t));return this.createFile(t,i,n,s);case 1:throw c.ENOENT(t);default:throw new c(22,\"Invalid FileFlag object.\")}}})}access(t,i,n){return u(this,null,function*(){throw new c(95)})}accessSync(t,i,n){throw new c(95)}rename(t,i,n){return u(this,null,function*(){throw new c(95)})}renameSync(t,i,n){throw new c(95)}stat(t,i){return u(this,null,function*(){throw new c(95)})}statSync(t,i){throw new c(95)}openFileSync(t,i,n){throw new c(95)}createFileSync(t,i,n,s){throw new c(95)}openSync(t,i,n,s){let o;try{o=this.statSync(t,s)}catch(l){switch(i.pathNotExistsAction()){case 3:if(!this.statSync(F(t),s).isDirectory())throw c.ENOTDIR(F(t));return this.createFileSync(t,i,n,s);case 1:throw c.ENOENT(t);default:throw new c(22,\"Invalid FileFlag object.\")}}if(!o.hasAccess(n,s))throw c.EACCES(t);switch(i.pathExistsAction()){case 1:throw c.EEXIST(t);case 2:return this.unlinkSync(t,s),this.createFileSync(t,i,o.mode,s);case 0:return this.openFileSync(t,i,s);default:throw new c(22,\"Invalid FileFlag object.\")}}unlink(t,i){return u(this,null,function*(){throw new c(95)})}unlinkSync(t,i){throw new c(95)}rmdir(t,i){return u(this,null,function*(){throw new c(95)})}rmdirSync(t,i){throw new c(95)}mkdir(t,i,n){return u(this,null,function*(){throw new c(95)})}mkdirSync(t,i,n){throw new c(95)}readdir(t,i){return u(this,null,function*(){throw new c(95)})}readdirSync(t,i){throw new c(95)}exists(t,i){return u(this,null,function*(){try{return yield this.stat(t,i),!0}catch(n){return!1}})}existsSync(t,i){try{return this.statSync(t,i),!0}catch(n){return!1}}realpath(t,i){return u(this,null,function*(){if(this.metadata.supportsLinks){let n=t.split(ft);for(let s=0;s<n.length;s++){let o=n.slice(0,s+1);n[s]=U(...o)}return n.join(ft)}else{if(!(yield this.exists(t,i)))throw c.ENOENT(t);return t}})}realpathSync(t,i){if(this.metadata.supportsLinks){let n=t.split(ft);for(let s=0;s<n.length;s++){let o=n.slice(0,s+1);n[s]=U(...o)}return n.join(ft)}else{if(this.existsSync(t,i))return t;throw c.ENOENT(t)}}truncate(t,i,n){return u(this,null,function*(){let s=yield this.open(t,w.getFileFlag(\"r+\"),420,n);try{yield s.truncate(i)}finally{yield s.close()}})}truncateSync(t,i,n){let s=this.openSync(t,w.getFileFlag(\"r+\"),420,n);try{s.truncateSync(i)}finally{s.closeSync()}}readFile(t,i,n){return u(this,null,function*(){let s=yield this.open(t,i,420,n);try{let o=yield s.stat(),l=new Uint8Array(o.size);return yield s.read(l,0,o.size,0),yield s.close(),l}finally{yield s.close()}})}readFileSync(t,i,n){let s=this.openSync(t,i,420,n);try{let o=s.statSync(),l=new Uint8Array(o.size);return s.readSync(l,0,o.size,0),s.closeSync(),l}finally{s.closeSync()}}writeFile(t,i,n,s,o){return u(this,null,function*(){let l=yield this.open(t,n,s,o);try{typeof i==\"string\"&&(i=S(i)),yield l.write(i,0,i.length,0)}finally{yield l.close()}})}writeFileSync(t,i,n,s,o){let l=this.openSync(t,n,s,o);try{typeof i==\"string\"&&(i=S(i)),l.writeSync(i,0,i.length,0)}finally{l.closeSync()}}appendFile(t,i,n,s,o){return u(this,null,function*(){let l=yield this.open(t,n,s,o);try{typeof i==\"string\"&&(i=S(i)),yield l.write(i,0,i.length,null)}finally{yield l.close()}})}appendFileSync(t,i,n,s,o){let l=this.openSync(t,n,s,o);try{typeof i==\"string\"&&(i=S(i)),l.writeSync(i,0,i.length,null)}finally{l.closeSync()}}chmod(t,i,n){return u(this,null,function*(){throw new c(95)})}chmodSync(t,i,n){throw new c(95)}chown(t,i,n,s){return u(this,null,function*(){throw new c(95)})}chownSync(t,i,n,s){throw new c(95)}utimes(t,i,n,s){return u(this,null,function*(){throw new c(95)})}utimesSync(t,i,n,s){throw new c(95)}link(t,i,n){return u(this,null,function*(){throw new c(95)})}linkSync(t,i,n){throw new c(95)}symlink(t,i,n,s){return u(this,null,function*(){throw new c(95)})}symlinkSync(t,i,n,s){throw new c(95)}readlink(t,i){return u(this,null,function*(){throw new c(95)})}readlinkSync(t,i){throw new c(95)}},j=fe;a(j,\"BaseFileSystem\"),j.Name=fe.name;var lt=class extends j{get metadata(){return G(X({},super.metadata),{synchronous:!0})}access(e,t,i){return u(this,null,function*(){return this.accessSync(e,t,i)})}rename(e,t,i){return u(this,null,function*(){return this.renameSync(e,t,i)})}stat(e,t){return u(this,null,function*(){return this.statSync(e,t)})}open(e,t,i,n){return u(this,null,function*(){return this.openSync(e,t,i,n)})}unlink(e,t){return u(this,null,function*(){return this.unlinkSync(e,t)})}rmdir(e,t){return u(this,null,function*(){return this.rmdirSync(e,t)})}mkdir(e,t,i){return u(this,null,function*(){return this.mkdirSync(e,t,i)})}readdir(e,t){return u(this,null,function*(){return this.readdirSync(e,t)})}chmod(e,t,i){return u(this,null,function*(){return this.chmodSync(e,t,i)})}chown(e,t,i,n){return u(this,null,function*(){return this.chownSync(e,t,i,n)})}utimes(e,t,i,n){return u(this,null,function*(){return this.utimesSync(e,t,i,n)})}link(e,t,i){return u(this,null,function*(){return this.linkSync(e,t,i)})}symlink(e,t,i,n){return u(this,null,function*(){return this.symlinkSync(e,t,i,n)})}readlink(e,t){return u(this,null,function*(){return this.readlinkSync(e,t)})}};a(lt,\"SynchronousFileSystem\");var R=class{constructor(e,t,i,n,s,o,l,d){this.id=e;this.size=t;this.mode=i;this.atime=n;this.mtime=s;this.ctime=o;this.uid=l;this.gid=d}static Deserialize(e){let t=new DataView(\"buffer\"in e?e.buffer:e);return new R(B(t.buffer.slice(38)),t.getUint32(0,!0),t.getUint16(4,!0),t.getFloat64(6,!0),t.getFloat64(14,!0),t.getFloat64(22,!0),t.getUint32(30,!0),t.getUint32(34,!0))}toStats(){return new k((this.mode&61440)===_.DIRECTORY?_.DIRECTORY:_.FILE,this.size,this.mode,this.atime,this.mtime,this.ctime,this.uid,this.gid)}getSize(){return 38+this.id.length}serialize(e=new Uint8Array(this.getSize())){let t=new DataView(\"buffer\"in e?e.buffer:e);t.setUint32(0,this.size,!0),t.setUint16(4,this.mode,!0),t.setFloat64(6,this.atime,!0),t.setFloat64(14,this.mtime,!0),t.setFloat64(22,this.ctime,!0),t.setUint32(30,this.uid,!0),t.setUint32(34,this.gid,!0);let i=new Uint8Array(t.buffer);return i.set(S(this.id),38),i}update(e){let t=!1;this.size!==e.size&&(this.size=e.size,t=!0),this.mode!==e.mode&&(this.mode=e.mode,t=!0);let i=e.atime.getTime();this.atime!==i&&(this.atime=i,t=!0);let n=e.mtime.getTime();this.mtime!==n&&(this.mtime=n,t=!0);let s=e.ctime.getTime();return this.ctime!==s&&(this.ctime=s,t=!0),this.uid!==e.uid&&(this.uid=e.uid,t=!0),this.uid!==e.uid&&(this.uid=e.uid,t=!0),t}isFile(){return(this.mode&61440)===_.FILE}isDirectory(){return(this.mode&61440)===_.DIRECTORY}};a(R,\"Inode\");var vt=class{constructor(e){this.store=e;this.originalData={};this.modifiedKeys=[]}get(e){let t=this.store.get(e);return this.stashOldValue(e,t),t}put(e,t,i){return this.markModified(e),this.store.put(e,t,i)}del(e){this.markModified(e),this.store.del(e)}commit(){}abort(){for(let e of this.modifiedKeys){let t=this.originalData[e];t?this.store.put(e,t,!0):this.store.del(e)}}_has(e){return Object.prototype.hasOwnProperty.call(this.originalData,e)}stashOldValue(e,t){this._has(e)||(this.originalData[e]=t)}markModified(e){this.modifiedKeys.indexOf(e)===-1&&(this.modifiedKeys.push(e),this._has(e)||(this.originalData[e]=this.store.get(e)))}};a(vt,\"SimpleSyncRWTransaction\");var Et=class extends M{constructor(e,t,i,n,s){super(e,t,i,n,s)}syncSync(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())}closeSync(){this.syncSync()}};a(Et,\"SyncKeyValueFile\");var _t=class extends lt{constructor(t){super();this.store=t.store,this.makeRootDirectory()}static isAvailable(){return!0}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!0}supportsSynch(){return!0}empty(){this.store.clear(),this.makeRootDirectory()}accessSync(t,i,n){let s=this.store.beginTransaction(\"readonly\");if(!this.findINode(s,t).toStats().hasAccess(i,n))throw c.EACCES(t)}renameSync(t,i,n){let s=this.store.beginTransaction(\"readwrite\"),o=F(t),l=I(t),d=F(i),m=I(i),f=this.findINode(s,o),h=this.getDirListing(s,o,f);if(!f.toStats().hasAccess(2,n))throw c.EACCES(t);if(!h[l])throw c.ENOENT(t);let y=h[l];if(delete h[l],(d+\"/\").indexOf(t+\"/\")===0)throw new c(16,o);let v,x;if(d===o?(v=f,x=h):(v=this.findINode(s,d),x=this.getDirListing(s,d,v)),x[m]){let g=this.getINode(s,i,x[m]);if(g.isFile())try{s.del(g.id),s.del(x[m])}catch(H){throw s.abort(),H}else throw c.EPERM(i)}x[m]=y;try{s.put(f.id,S(JSON.stringify(h)),!0),s.put(v.id,S(JSON.stringify(x)),!0)}catch(g){throw s.abort(),g}s.commit()}statSync(t,i){let n=this.findINode(this.store.beginTransaction(\"readonly\"),t).toStats();if(!n.hasAccess(4,i))throw c.EACCES(t);return n}createFileSync(t,i,n,s){let o=this.store.beginTransaction(\"readwrite\"),l=new Uint8Array(0),d=this.commitNewFile(o,t,_.FILE,n,s,l);return new Et(this,t,i,d.toStats(),l)}openFileSync(t,i,n){let s=this.store.beginTransaction(\"readonly\"),o=this.findINode(s,t),l=s.get(o.id);if(!o.toStats().hasAccess(i.getMode(),n))throw c.EACCES(t);if(l===void 0)throw c.ENOENT(t);return new Et(this,t,i,o.toStats(),l)}unlinkSync(t,i){this.removeEntry(t,!1,i)}rmdirSync(t,i){if(this.readdirSync(t,i).length>0)throw c.ENOTEMPTY(t);this.removeEntry(t,!0,i)}mkdirSync(t,i,n){let s=this.store.beginTransaction(\"readwrite\"),o=S(\"{}\");this.commitNewFile(s,t,_.DIRECTORY,i,n,o)}readdirSync(t,i){let n=this.store.beginTransaction(\"readonly\"),s=this.findINode(n,t);if(!s.toStats().hasAccess(4,i))throw c.EACCES(t);return Object.keys(this.getDirListing(n,t,s))}chmodSync(t,i,n){this.openFileSync(t,w.getFileFlag(\"r+\"),n).chmodSync(i)}chownSync(t,i,n,s){this.openFileSync(t,w.getFileFlag(\"r+\"),s).chownSync(i,n)}_syncSync(t,i,n){let s=this.store.beginTransaction(\"readwrite\"),o=this._findINode(s,F(t),I(t)),l=this.getINode(s,t,o),d=l.update(n);try{s.put(l.id,i,!0),d&&s.put(o,l.serialize(),!0)}catch(m){throw s.abort(),m}s.commit()}makeRootDirectory(){let t=this.store.beginTransaction(\"readwrite\");if(t.get(W)===void 0){let i=new Date().getTime(),n=new R(ht(),4096,511|_.DIRECTORY,i,i,i,0,0);t.put(n.id,S(\"{}\"),!1),t.put(W,n.serialize(),!1),t.commit()}}_findINode(t,i,n,s=new Set){let o=U(i,n);if(s.has(o))throw new c(5,\"Infinite loop detected while finding inode\",o);s.add(o);let l=a(d=>{let m=this.getDirListing(t,i,d);if(m[n])return m[n];throw c.ENOENT(P(i,n))},\"readDirectory\");return i===\"/\"?n===\"\"?W:l(this.getINode(t,i,W)):l(this.getINode(t,i+ft+n,this._findINode(t,F(i),I(i),s)))}findINode(t,i){return this.getINode(t,i,this._findINode(t,F(i),I(i)))}getINode(t,i,n){let s=t.get(n);if(s===void 0)throw c.ENOENT(i);return R.Deserialize(s)}getDirListing(t,i,n){if(!n.isDirectory())throw c.ENOTDIR(i);let s=t.get(n.id);if(s===void 0)throw c.ENOENT(i);return JSON.parse(s.toString())}addNewNode(t,i){let s;for(;0<5;)try{return s=ht(),t.put(s,i,!1),s}catch(o){}throw new c(5,\"Unable to commit data to key-value store.\")}commitNewFile(t,i,n,s,o,l){let d=F(i),m=I(i),f=this.findINode(t,d),h=this.getDirListing(t,d,f),y=new Date().getTime();if(!f.toStats().hasAccess(4,o))throw c.EACCES(i);if(i===\"/\")throw c.EEXIST(i);if(h[m])throw c.EEXIST(i);let v;try{let x=this.addNewNode(t,l);v=new R(x,l.length,s|n,y,y,y,o.uid,o.gid);let g=this.addNewNode(t,v.serialize());h[m]=g,t.put(f.id,S(JSON.stringify(h)),!0)}catch(x){throw t.abort(),x}return t.commit(),v}removeEntry(t,i,n){let s=this.store.beginTransaction(\"readwrite\"),o=F(t),l=this.findINode(s,o),d=this.getDirListing(s,o,l),m=I(t);if(!d[m])throw c.ENOENT(t);let f=d[m],h=this.getINode(s,t,f);if(!h.toStats().hasAccess(2,n))throw c.EACCES(t);if(delete d[m],!i&&h.isDirectory())throw c.EISDIR(t);if(i&&!h.isDirectory())throw c.ENOTDIR(t);try{s.del(h.id),s.del(f),s.put(l.id,S(JSON.stringify(d)),!0)}catch(y){throw s.abort(),y}s.commit()}};a(_t,\"SyncKeyValueFileSystem\");function ut(r,e){e=typeof r==\"function\"?r:e,de(this,r);let t=new this(typeof r==\"function\"?{}:r);if(typeof e!=\"function\")return t.whenReady();t.whenReady().then(i=>e(null,i)).catch(i=>e(i))}a(ut,\"CreateBackend\");var qt=class{constructor(){this.store=new Map}name(){return $.Name}clear(){this.store.clear()}beginTransaction(e){return new vt(this)}get(e){return this.store.get(e)}put(e,t,i){return!i&&this.store.has(e)?!1:(this.store.set(e,t),!0)}del(e){this.store.delete(e)}};a(qt,\"InMemoryStore\");var he=class extends _t{constructor(){super({store:new qt})}},$=he;a($,\"InMemoryFileSystem\"),$.Name=\"InMemory\",$.Create=ut.bind(he),$.Options={};function oi(r){if(typeof r==\"number\")return r;if(r instanceof Date)return r.getTime()/1e3;throw new Error(\"Cannot parse time: \"+r)}a(oi,\"_toUnixTimestamp\");function z(r,e){switch(typeof r){case\"number\":return r;case\"string\":let t=parseInt(r,8);return isNaN(t)?e:t;default:return e}}a(z,\"normalizeMode\");function L(r){if(r instanceof Date)return r;if(typeof r==\"number\")return new Date(r*1e3);throw new c(22,\"Invalid time.\")}a(L,\"normalizeTime\");function O(r){if(r.indexOf(\"\\0\")>=0)throw new c(22,\"Path must be a string without null bytes.\");if(r===\"\")throw new c(22,\"Path must not be empty.\");return r=r.replaceAll(/\\/+/g,\"/\"),P(r)}a(O,\"normalizePath\");function dt(r,e,t,i){switch(r===null?\"null\":typeof r){case\"object\":return{encoding:typeof r.encoding!=\"undefined\"?r.encoding:e,flag:typeof r.flag!=\"undefined\"?r.flag:t,mode:z(r.mode,i)};case\"string\":return{encoding:r,flag:t,mode:i};case\"null\":case\"undefined\":case\"function\":return{encoding:e,flag:t,mode:i};default:throw new TypeError(`\"options\" must be a string or an object, got ${typeof r} instead.`)}}a(dt,\"normalizeOptions\");function b(){}a(b,\"nop\");var p=E.Root;function ai(r){p=r}a(ai,\"setCred\");var pt=new Map,mr=100;function Ht(r){let e=mr++;return pt.set(e,r),e}a(Ht,\"getFdForFile\");function C(r){if(!pt.has(r))throw new c(9,\"Invalid file descriptor.\");return pt.get(r)}a(C,\"fd2file\");var J=new Map;$.Create().then(r=>Gt(\"/\",r));function xt(r){return J.get(r)}a(xt,\"getMount\");function ci(){return Object.fromEntries(J.entries())}a(ci,\"getMounts\");function Gt(r,e){if(r[0]!==\"/\"&&(r=\"/\"+r),r=P(r),J.has(r))throw new c(22,\"Mount point \"+r+\" is already in use.\");J.set(r,e)}a(Gt,\"mount\");function pe(r){if(r[0]!==\"/\"&&(r=`/${r}`),r=P(r),!J.has(r))throw new c(22,\"Mount point \"+r+\" is already unmounted.\");J.delete(r)}a(pe,\"umount\");function Y(r){let e=[...J].sort((t,i)=>t[0].length>i[0].length?-1:1);for(let[t,i]of e)if(t.length<=r.length&&r.startsWith(t))return r=r.slice(t.length>1?t.length:0),r===\"\"&&(r=\"/\"),{fs:i,path:r,mountPoint:t};throw new c(5,\"BrowserFS not initialized with a file system\")}a(Y,\"resolveFS\");function si(r,e){for(let[t,i]of Object.entries(e))r=r.replaceAll(t,i);return r}a(si,\"fixPaths\");function mt(r,e){return r.stack=si(r.stack,e),r.message=si(r.message,e),r}a(mt,\"fixError\");function li(r){r[\"/\"]&&pe(\"/\");for(let[e,t]of Object.entries(r)){if(!t.constructor.isAvailable())throw new c(22,`Can not mount \"${e}\" since the filesystem is unavailable.`);Gt(e,t)}}a(li,\"initialize\");var It={};zt(It,{access:()=>Ke,appendFile:()=>Fe,chmod:()=>Me,chown:()=>Le,close:()=>ve,constants:()=>Ft,createReadStream:()=>gr,createWriteStream:()=>yr,exists:()=>Qt,fchmod:()=>Te,fchown:()=>Oe,fdatasync:()=>Ce,fstat:()=>xe,fsync:()=>_e,ftruncate:()=>Ee,futimes:()=>Ne,lchmod:()=>ze,lchown:()=>Be,link:()=>De,lstat:()=>be,lutimes:()=>We,mkdir:()=>Pe,open:()=>we,read:()=>ke,readFile:()=>te,readdir:()=>Ie,readlink:()=>Re,realpath:()=>Pt,rename:()=>ge,rmdir:()=>Ae,stat:()=>ye,symlink:()=>Ue,truncate:()=>Se,unlink:()=>Zt,unwatchFile:()=>hr,utimes:()=>Ve,watch:()=>pr,watchFile:()=>fr,write:()=>ie,writeFile:()=>ee});function T(){return u(this,arguments,function*(...[r,e,t,...i]){t=O(t);let{fs:n,path:s}=Y(e&&(yield Qt(t))?yield Pt(t):t);try{return n[r](s,...i)}catch(o){throw mt(o,{[s]:t})}})}a(T,\"doOp\");function ge(r,e){return u(this,null,function*(){r=O(r),e=O(e);let t=Y(r),i=Y(e),n={[t.path]:r,[i.path]:e};try{if(t===i)return t.fs.rename(t.path,i.path,p);let s=yield te(r);yield ee(e,s),yield Zt(r)}catch(s){throw mt(s,n)}})}a(ge,\"rename\");function Qt(r){return u(this,null,function*(){r=O(r);try{let{fs:e,path:t}=Y(r);return e.exists(t,p)}catch(e){if(e.errno==2)return!1;throw e}})}a(Qt,\"exists\");function ye(r){return u(this,null,function*(){return T(\"stat\",!0,r,p)})}a(ye,\"stat\");function be(r){return u(this,null,function*(){return T(\"stat\",!1,r,p)})}a(be,\"lstat\");function Se(r,e=0){return u(this,null,function*(){if(e<0)throw new c(22);return T(\"truncate\",!0,r,e,p)})}a(Se,\"truncate\");function Zt(r){return u(this,null,function*(){return T(\"unlink\",!1,r,p)})}a(Zt,\"unlink\");function we(r,e,t=420){return u(this,null,function*(){let i=yield T(\"open\",!0,r,w.getFileFlag(e),z(t,420),p);return Ht(i)})}a(we,\"open\");function te(t){return u(this,arguments,function*(r,e={}){let i=dt(e,null,\"r\",null),n=w.getFileFlag(i.flag);if(!n.isReadable())throw new c(22,\"Flag passed to readFile must allow for reading.\");let s=yield T(\"readFile\",!0,r,n,p);switch(i.encoding){case\"utf8\":case\"utf-8\":return B(s);default:return s}})}a(te,\"readFile\");function ee(r,e,t){return u(this,null,function*(){let i=dt(t,\"utf8\",\"w\",420),n=w.getFileFlag(i.flag);if(!n.isWriteable())throw new c(22,\"Flag passed to writeFile must allow for writing.\");if(typeof e!=\"string\"&&!i.encoding)throw new c(22,\"Encoding not specified\");let s=typeof e==\"string\"?S(e):e;return T(\"writeFile\",!0,r,s,n,i.mode,p)})}a(ee,\"writeFile\");function Fe(r,e,t){return u(this,null,function*(){let i=dt(t,\"utf8\",\"a\",420),n=w.getFileFlag(i.flag);if(!n.isAppendable())throw new c(22,\"Flag passed to appendFile must allow for appending.\");if(typeof e!=\"string\"&&!i.encoding)throw new c(22,\"Encoding not specified\");let s=typeof e==\"string\"?S(e):e;return T(\"appendFile\",!0,r,s,n,i.mode,p)})}a(Fe,\"appendFile\");function xe(r){return u(this,null,function*(){return C(r).stat()})}a(xe,\"fstat\");function ve(r){return u(this,null,function*(){yield C(r).close(),pt.delete(r)})}a(ve,\"close\");function Ee(r,e=0){return u(this,null,function*(){let t=C(r);if(e<0)throw new c(22);return t.truncate(e)})}a(Ee,\"ftruncate\");function _e(r){return u(this,null,function*(){return C(r).sync()})}a(_e,\"fsync\");function Ce(r){return u(this,null,function*(){return C(r).datasync()})}a(Ce,\"fdatasync\");function ie(r,e,t,i,n){return u(this,null,function*(){let s,o=0,l,d;if(typeof e==\"string\"){d=typeof t==\"number\"?t:null;let f=typeof i==\"string\"?i:\"utf8\";o=0,s=S(e),l=s.length}else s=e,o=t,l=i,d=typeof n==\"number\"?n:null;let m=C(r);return d==null&&(d=m.getPos()),m.write(s,o,l,d)})}a(ie,\"write\");function ke(r,e,t,i,n){return u(this,null,function*(){let s=C(r);return isNaN(+n)&&(n=s.getPos()),s.read(e,t,i,n)})}a(ke,\"read\");function Oe(r,e,t){return u(this,null,function*(){return C(r).chown(e,t)})}a(Oe,\"fchown\");function Te(r,e){return u(this,null,function*(){let t=typeof e==\"string\"?parseInt(e,8):e;return C(r).chmod(t)})}a(Te,\"fchmod\");function Ne(r,e,t){return u(this,null,function*(){return C(r).utimes(L(e),L(t))})}a(Ne,\"futimes\");function Ae(r){return u(this,null,function*(){return T(\"rmdir\",!0,r,p)})}a(Ae,\"rmdir\");function Pe(r,e){return u(this,null,function*(){return T(\"mkdir\",!0,r,z(e,511),p)})}a(Pe,\"mkdir\");function Ie(r){return u(this,null,function*(){r=O(r);let e=yield T(\"readdir\",!0,r,p),t=[...J.keys()];for(let i of t)if(i.startsWith(r)){let n=i.slice(r.length);if(n.includes(\"/\")||n.length==0)continue;e.push(n)}return e})}a(Ie,\"readdir\");function De(r,e){return u(this,null,function*(){return e=O(e),T(\"link\",!1,r,e,p)})}a(De,\"link\");function Ue(r,e,t=\"file\"){return u(this,null,function*(){if(![\"file\",\"dir\",\"junction\"].includes(t))throw new c(22,\"Invalid type: \"+t);return e=O(e),T(\"symlink\",!1,r,e,t,p)})}a(Ue,\"symlink\");function Re(r){return u(this,null,function*(){return T(\"readlink\",!1,r,p)})}a(Re,\"readlink\");function Le(r,e,t){return u(this,null,function*(){return T(\"chown\",!0,r,e,t,p)})}a(Le,\"chown\");function Be(r,e,t){return u(this,null,function*(){return T(\"chown\",!1,r,e,t,p)})}a(Be,\"lchown\");function Me(r,e){return u(this,null,function*(){let t=z(e,-1);if(t<0)throw new c(22,\"Invalid mode.\");return T(\"chmod\",!0,r,t,p)})}a(Me,\"chmod\");function ze(r,e){return u(this,null,function*(){let t=z(e,-1);if(t<1)throw new c(22,\"Invalid mode.\");return T(\"chmod\",!1,O(r),t,p)})}a(ze,\"lchmod\");function Ve(r,e,t){return u(this,null,function*(){return T(\"utimes\",!0,r,L(e),L(t),p)})}a(Ve,\"utimes\");function We(r,e,t){return u(this,null,function*(){return T(\"utimes\",!1,r,L(e),L(t),p)})}a(We,\"lutimes\");function Pt(t){return u(this,arguments,function*(r,e={}){r=O(r);let{fs:i,path:n,mountPoint:s}=Y(r);try{if(!(yield i.stat(n,p)).isSymbolicLink())return r;let l=s+O(yield i.readlink(n,p));return Pt(l)}catch(o){throw mt(o,{[n]:r})}})}a(Pt,\"realpath\");function fr(i,n){return u(this,arguments,function*(r,e,t=b){throw new c(95)})}a(fr,\"watchFile\");function hr(t){return u(this,arguments,function*(r,e=b){throw new c(95)})}a(hr,\"unwatchFile\");function pr(i,n){return u(this,arguments,function*(r,e,t=b){throw new c(95)})}a(pr,\"watch\");function Ke(r,e=384){return u(this,null,function*(){return T(\"access\",!0,r,e,p)})}a(Ke,\"access\");function gr(r,e){return u(this,null,function*(){throw new c(95)})}a(gr,\"createReadStream\");function yr(r,e){return u(this,null,function*(){throw new c(95)})}a(yr,\"createWriteStream\");function br(r,e,t=b){ge(r,e).then(()=>t()).catch(t)}a(br,\"rename\");function Sr(r,e=b){Qt(r).then(e).catch(()=>e(!1))}a(Sr,\"exists\");function wr(r,e=b){ye(r).then(t=>e(null,t)).catch(e)}a(wr,\"stat\");function Fr(r,e=b){be(r).then(t=>e(null,t)).catch(e)}a(Fr,\"lstat\");function xr(r,e=0,t=b){t=typeof e==\"function\"?e:t,Se(r,typeof e==\"number\"?e:0).then(()=>t()).catch(t)}a(xr,\"truncate\");function vr(r,e=b){Zt(r).then(()=>e()).catch(e)}a(vr,\"unlink\");function Er(r,e,t,i=b){let n=z(t,420);i=typeof t==\"function\"?t:i,we(r,e,n).then(s=>i(null,s)).catch(i)}a(Er,\"open\");function _r(r,e={},t=b){t=typeof e==\"function\"?e:t,te(r,typeof e==\"function\"?null:e)}a(_r,\"readFile\");function Cr(r,e,t={},i=b){i=typeof t==\"function\"?t:i,ee(r,e,typeof t==\"function\"?void 0:t)}a(Cr,\"writeFile\");function kr(r,e,t,i=b){i=typeof t==\"function\"?t:i,Fe(r,e,typeof t==\"function\"?null:t)}a(kr,\"appendFile\");function Or(r,e=b){xe(r).then(t=>e(null,t)).catch(e)}a(Or,\"fstat\");function Tr(r,e=b){ve(r).then(()=>e()).catch(e)}a(Tr,\"close\");function Nr(r,e,t=b){let i=typeof e==\"number\"?e:0;t=typeof e==\"function\"?e:t,Ee(r,i)}a(Nr,\"ftruncate\");function Ar(r,e=b){_e(r).then(()=>e()).catch(e)}a(Ar,\"fsync\");function Pr(r,e=b){Ce(r).then(()=>e()).catch(e)}a(Pr,\"fdatasync\");function Ir(r,e,t,i,n,s=b){let o,l,d,m=null,f;if(typeof e==\"string\"){switch(f=\"utf8\",typeof t){case\"function\":s=t;break;case\"number\":m=t,f=typeof i==\"string\"?i:\"utf8\",s=typeof n==\"function\"?n:s;break;default:s=typeof i==\"function\"?i:typeof n==\"function\"?n:s,s(new c(22,\"Invalid arguments.\"));return}o=S(e),l=0,d=o.length;let h=s;ie(r,o,l,d,m).then(y=>h(null,y,B(o))).catch(h)}else{o=e,l=t,d=i,m=typeof n==\"number\"?n:null;let h=typeof n==\"function\"?n:s;ie(r,o,l,d,m).then(y=>h(null,y,o)).catch(h)}}a(Ir,\"write\");function Dr(r,e,t,i,n,s=b){ke(r,e,t,i,n).then(({bytesRead:o,buffer:l})=>s(null,o,l)).catch(s)}a(Dr,\"read\");function Ur(r,e,t,i=b){Oe(r,e,t).then(()=>i()).catch(i)}a(Ur,\"fchown\");function Rr(r,e,t){Te(r,e).then(()=>t()).catch(t)}a(Rr,\"fchmod\");function Lr(r,e,t,i=b){Ne(r,e,t).then(()=>i()).catch(i)}a(Lr,\"futimes\");function Br(r,e=b){Ae(r).then(()=>e()).catch(e)}a(Br,\"rmdir\");function Mr(r,e,t=b){Pe(r,e).then(()=>t()).catch(t)}a(Mr,\"mkdir\");function zr(r,e=b){Ie(r).then(t=>e(null,t)).catch(e)}a(zr,\"readdir\");function Vr(r,e,t=b){De(r,e).then(()=>t()).catch(t)}a(Vr,\"link\");function Wr(r,e,t,i=b){let n=typeof t==\"string\"?t:\"file\";i=typeof t==\"function\"?t:i,Ue(r,e,typeof t==\"function\"?null:t).then(()=>i()).catch(i)}a(Wr,\"symlink\");function Kr(r,e=b){Re(r).then(t=>e(null,t)).catch(e)}a(Kr,\"readlink\");function jr(r,e,t,i=b){Le(r,e,t).then(()=>i()).catch(i)}a(jr,\"chown\");function $r(r,e,t,i=b){Be(r,e,t).then(()=>i()).catch(i)}a($r,\"lchown\");function Yr(r,e,t=b){Me(r,e).then(()=>t()).catch(t)}a(Yr,\"chmod\");function Xr(r,e,t=b){ze(r,e).then(()=>t()).catch(t)}a(Xr,\"lchmod\");function Jr(r,e,t,i=b){Ve(r,e,t).then(()=>i()).catch(i)}a(Jr,\"utimes\");function qr(r,e,t,i=b){We(r,e,t).then(()=>i()).catch(i)}a(qr,\"lutimes\");function Hr(r,e,t=b){let i=typeof e==\"object\"?e:{};t=typeof e==\"function\"?e:t,Pt(r,typeof e==\"function\"?null:e).then(n=>t(null,n)).catch(t)}a(Hr,\"realpath\");function Gr(r,e,t=b){let i=typeof e==\"number\"?e:4;t=typeof e==\"function\"?e:t,Ke(r,typeof e==\"function\"?null:e).then(()=>t()).catch(t)}a(Gr,\"access\");function Qr(r,e,t=b){throw new c(95)}a(Qr,\"watchFile\");function Zr(r,e=b){throw new c(95)}a(Zr,\"unwatchFile\");function tn(r,e,t=b){throw new c(95)}a(tn,\"watch\");function en(r,e){throw new c(95)}a(en,\"createReadStream\");function rn(r,e){throw new c(95)}a(rn,\"createWriteStream\");function N(...[r,e,t,...i]){t=O(t);let{fs:n,path:s}=Y(e&&ui(t)?je(t):t);try{return n[r](s,...i)}catch(o){throw mt(o,{[s]:t})}}a(N,\"doOp\");function nn(r,e){r=O(r),e=O(e);let t=Y(r),i=Y(e),n={[t.path]:r,[i.path]:e};try{if(t===i)return t.fs.renameSync(t.path,i.path,p);let s=mi(r);fi(e,s),di(r)}catch(s){throw mt(s,n)}}a(nn,\"renameSync\");function ui(r){r=O(r);try{let{fs:e,path:t}=Y(r);return e.existsSync(t,p)}catch(e){if(e.errno==2)return!1;throw e}}a(ui,\"existsSync\");function sn(r){return N(\"statSync\",!0,r,p)}a(sn,\"statSync\");function on(r){return N(\"statSync\",!1,r,p)}a(on,\"lstatSync\");function an(r,e=0){if(e<0)throw new c(22);return N(\"truncateSync\",!0,r,e,p)}a(an,\"truncateSync\");function di(r){return N(\"unlinkSync\",!1,r,p)}a(di,\"unlinkSync\");function cn(r,e,t=420){let i=N(\"openSync\",!0,r,w.getFileFlag(e),z(t,420),p);return Ht(i)}a(cn,\"openSync\");function mi(r,e={}){let t=dt(e,null,\"r\",null),i=w.getFileFlag(t.flag);if(!i.isReadable())throw new c(22,\"Flag passed to readFile must allow for reading.\");let n=N(\"readFileSync\",!0,r,i,p);switch(t.encoding){case\"utf8\":case\"utf-8\":return B(n);default:return n}}a(mi,\"readFileSync\");function fi(r,e,t){let i=dt(t,\"utf8\",\"w\",420),n=w.getFileFlag(i.flag);if(!n.isWriteable())throw new c(22,\"Flag passed to writeFile must allow for writing.\");if(typeof e!=\"string\"&&!i.encoding)throw new c(22,\"Encoding not specified\");let s=typeof e==\"string\"?S(e):e;return N(\"writeFileSync\",!0,r,s,n,i.mode,p)}a(fi,\"writeFileSync\");function ln(r,e,t){let i=dt(t,\"utf8\",\"a\",420),n=w.getFileFlag(i.flag);if(!n.isAppendable())throw new c(22,\"Flag passed to appendFile must allow for appending.\");if(typeof e!=\"string\"&&!i.encoding)throw new c(22,\"Encoding not specified\");let s=typeof e==\"string\"?S(e):e;return N(\"appendFileSync\",!0,r,s,n,i.mode,p)}a(ln,\"appendFileSync\");function un(r){return C(r).statSync()}a(un,\"fstatSync\");function dn(r){C(r).closeSync(),pt.delete(r)}a(dn,\"closeSync\");function mn(r,e=0){let t=C(r);if(e<0)throw new c(22);t.truncateSync(e)}a(mn,\"ftruncateSync\");function fn(r){C(r).syncSync()}a(fn,\"fsyncSync\");function hn(r){C(r).datasyncSync()}a(hn,\"fdatasyncSync\");function pn(r,e,t,i,n){let s,o=0,l,d;if(typeof e==\"string\"){d=typeof t==\"number\"?t:null;let f=typeof i==\"string\"?i:\"utf8\";o=0,s=S(e),l=s.length}else s=e,o=t,l=i,d=typeof n==\"number\"?n:null;let m=C(r);return d==null&&(d=m.getPos()),m.writeSync(s,o,l,d)}a(pn,\"writeSync\");function gn(r,e,t,i,n){let s=C(r),o=t;return typeof t==\"object\"&&({offset:o,length:i,position:n}=t),isNaN(+n)&&(n=s.getPos()),s.readSync(e,o,i,n)}a(gn,\"readSync\");function yn(r,e,t){C(r).chownSync(e,t)}a(yn,\"fchownSync\");function bn(r,e){let t=typeof e==\"string\"?parseInt(e,8):e;C(r).chmodSync(t)}a(bn,\"fchmodSync\");function Sn(r,e,t){C(r).utimesSync(L(e),L(t))}a(Sn,\"futimesSync\");function wn(r){return N(\"rmdirSync\",!0,r,p)}a(wn,\"rmdirSync\");function Fn(r,e){N(\"mkdirSync\",!0,r,z(e,511),p)}a(Fn,\"mkdirSync\");function xn(r){r=O(r);let e=N(\"readdirSync\",!0,r,p),t=[...J.keys()];for(let i of t)if(i.startsWith(r)){let n=i.slice(r.length);if(n.includes(\"/\")||n.length==0)continue;e.push(n)}return e}a(xn,\"readdirSync\");function vn(r,e){return e=O(e),N(\"linkSync\",!1,r,e,p)}a(vn,\"linkSync\");function En(r,e,t){if(![\"file\",\"dir\",\"junction\"].includes(t))throw new c(22,\"Invalid type: \"+t);return e=O(e),N(\"symlinkSync\",!1,r,e,t,p)}a(En,\"symlinkSync\");function _n(r){return N(\"readlinkSync\",!1,r,p)}a(_n,\"readlinkSync\");function Cn(r,e,t){N(\"chownSync\",!0,r,e,t,p)}a(Cn,\"chownSync\");function kn(r,e,t){N(\"chownSync\",!1,r,e,t,p)}a(kn,\"lchownSync\");function On(r,e){let t=z(e,-1);if(t<0)throw new c(22,\"Invalid mode.\");N(\"chmodSync\",!0,r,t,p)}a(On,\"chmodSync\");function Tn(r,e){let t=z(e,-1);if(t<1)throw new c(22,\"Invalid mode.\");N(\"chmodSync\",!1,r,t,p)}a(Tn,\"lchmodSync\");function Nn(r,e,t){N(\"utimesSync\",!0,r,L(e),L(t),p)}a(Nn,\"utimesSync\");function An(r,e,t){N(\"utimesSync\",!1,r,L(e),L(t),p)}a(An,\"lutimesSync\");function je(r,e={}){r=O(r);let{fs:t,path:i,mountPoint:n}=Y(r);try{if(!t.statSync(i,p).isSymbolicLink())return r;let o=O(n+t.readlinkSync(i,p));return je(o)}catch(s){throw mt(s,{[i]:r})}}a(je,\"realpathSync\");function Pn(r,e=384){return N(\"accessSync\",!0,r,e,p)}a(Pn,\"accessSync\");var In=$e,re=In;var ne=class extends M{constructor(e,t,i,n,s){super(e,t,i,n,s)}syncSync(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())}closeSync(){this.syncSync()}};a(ne,\"MirrorFile\");var Dt=class extends lt{constructor({sync:t,async:i}){super();this._queue=[];this._queueRunning=!1;this._isInitialized=!1;this._initializeCallbacks=[];this._sync=t,this._async=i,this._ready=this._initialize()}static isAvailable(){return!0}get metadata(){return G(X({},super.metadata),{name:Dt.Name,synchronous:!0,supportsProperties:this._sync.metadata.supportsProperties&&this._async.metadata.supportsProperties})}_syncSync(t){let i=t.getStats();this._sync.writeFileSync(t.getPath(),t.getBuffer(),w.getFileFlag(\"w\"),i.mode,i.getCred(0,0)),this.enqueueOp({apiMethod:\"writeFile\",arguments:[t.getPath(),t.getBuffer(),t.getFlag(),i.mode,i.getCred(0,0)]})}renameSync(t,i,n){this._sync.renameSync(t,i,n),this.enqueueOp({apiMethod:\"rename\",arguments:[t,i,n]})}statSync(t,i){return this._sync.statSync(t,i)}openSync(t,i,n,s){return this._sync.openSync(t,i,n,s).closeSync(),new ne(this,t,i,this._sync.statSync(t,s),this._sync.readFileSync(t,w.getFileFlag(\"r\"),s))}unlinkSync(t,i){this._sync.unlinkSync(t,i),this.enqueueOp({apiMethod:\"unlink\",arguments:[t,i]})}rmdirSync(t,i){this._sync.rmdirSync(t,i),this.enqueueOp({apiMethod:\"rmdir\",arguments:[t,i]})}mkdirSync(t,i,n){this._sync.mkdirSync(t,i,n),this.enqueueOp({apiMethod:\"mkdir\",arguments:[t,i,n]})}readdirSync(t,i){return this._sync.readdirSync(t,i)}existsSync(t,i){return this._sync.existsSync(t,i)}chmodSync(t,i,n){this._sync.chmodSync(t,i,n),this.enqueueOp({apiMethod:\"chmod\",arguments:[t,i,n]})}chownSync(t,i,n,s){this._sync.chownSync(t,i,n,s),this.enqueueOp({apiMethod:\"chown\",arguments:[t,i,n,s]})}utimesSync(t,i,n,s){this._sync.utimesSync(t,i,n,s),this.enqueueOp({apiMethod:\"utimes\",arguments:[t,i,n,s]})}_initialize(){return u(this,null,function*(){if(!this._isInitialized){let t=a((s,o)=>u(this,null,function*(){if(s!==\"/\"){let d=yield this._async.stat(s,E.Root);this._sync.mkdirSync(s,o,d.getCred())}let l=yield this._async.readdir(s,E.Root);for(let d of l)yield n(U(s,d))}),\"copyDirectory\"),i=a((s,o)=>u(this,null,function*(){let l=yield this._async.readFile(s,w.getFileFlag(\"r\"),E.Root);this._sync.writeFileSync(s,l,w.getFileFlag(\"w\"),o,E.Root)}),\"copyFile\"),n=a(s=>u(this,null,function*(){let o=yield this._async.stat(s,E.Root);o.isDirectory()?yield t(s,o.mode):yield i(s,o.mode)}),\"copyItem\");try{yield t(\"/\",0),this._isInitialized=!0}catch(s){throw this._isInitialized=!1,s}}return this})}enqueueOp(t){if(this._queue.push(t),!this._queueRunning){this._queueRunning=!0;let i=a(n=>{if(n)throw new Error(`WARNING: File system has desynchronized. Received following error: ${n}\n$`);if(this._queue.length>0){let s=this._queue.shift();s.arguments.push(i),this._async[s.apiMethod].apply(this._async,s.arguments)}else this._queueRunning=!1},\"doNextOp\");i()}}},et=Dt;a(et,\"AsyncMirror\"),et.Name=\"AsyncMirror\",et.Create=ut.bind(Dt),et.Options={sync:{type:\"object\",description:\"The synchronous file system to mirror the asynchronous file system to.\",validator:t=>u(Dt,null,function*(){if(!(t!=null&&t.metadata.synchronous))throw new c(22,\"'sync' option must be a file system that supports synchronous operations\")})},async:{type:\"object\",description:\"The asynchronous file system to mirror.\"}};var Ye=class extends j{constructor({folder:t,wrapped:i}){super();this._folder=t,this._wrapped=i,this._ready=this._initialize()}static isAvailable(){return!0}get metadata(){return G(X(X({},super.metadata),this._wrapped.metadata),{supportsLinks:!1})}_initialize(){return u(this,null,function*(){if(!(yield this._wrapped.exists(this._folder,E.Root))&&this._wrapped.metadata.readonly)throw c.ENOENT(this._folder);return yield this._wrapped.mkdir(this._folder,511,E.Root),this})}},q=Ye;a(q,\"FolderAdapter\"),q.Name=\"FolderAdapter\",q.Create=ut.bind(Ye),q.Options={folder:{type:\"string\",description:\"The folder to use as the root directory\"},wrapped:{type:\"object\",description:\"The file system to wrap\"}};function hi(r,e){if(e!==null&&typeof e==\"object\"){let t=e,i=t.path;i&&(i=\"/\"+ei(r,i),t.message=t.message.replace(t.path,i),t.path=i)}return e}a(hi,\"translateError\");function Dn(r,e){return typeof e==\"function\"?function(t){arguments.length>0&&(arguments[0]=hi(r,t)),e.apply(null,arguments)}:e}a(Dn,\"wrapCallback\");function pi(r,e,t){return r.slice(r.length-4)!==\"Sync\"?function(){return arguments.length>0&&(e&&(arguments[0]=U(this._folder,arguments[0])),t&&(arguments[1]=U(this._folder,arguments[1])),arguments[arguments.length-1]=Dn(this._folder,arguments[arguments.length-1])),this._wrapped[r].apply(this._wrapped,arguments)}:function(){try{return e&&(arguments[0]=U(this._folder,arguments[0])),t&&(arguments[1]=U(this._folder,arguments[1])),this._wrapped[r].apply(this._wrapped,arguments)}catch(i){throw hi(this._folder,i)}}}a(pi,\"wrapFunction\");[\"diskSpace\",\"stat\",\"statSync\",\"open\",\"openSync\",\"unlink\",\"unlinkSync\",\"rmdir\",\"rmdirSync\",\"mkdir\",\"mkdirSync\",\"readdir\",\"readdirSync\",\"exists\",\"existsSync\",\"realpath\",\"realpathSync\",\"truncate\",\"truncateSync\",\"readFile\",\"readFileSync\",\"writeFile\",\"writeFileSync\",\"appendFile\",\"appendFileSync\",\"chmod\",\"chmodSync\",\"chown\",\"chownSync\",\"utimes\",\"utimesSync\",\"readlink\",\"readlinkSync\"].forEach(r=>{q.prototype[r]=pi(r,!0,!1)});[\"rename\",\"renameSync\",\"link\",\"linkSync\",\"symlink\",\"symlinkSync\"].forEach(r=>{q.prototype[r]=pi(r,!0,!0)});var Ct=class{constructor(){this._locks=new Map}lock(e){return new Promise(t=>{this._locks.has(e)?this._locks.get(e).push(t):this._locks.set(e,[])})}unlock(e){if(!this._locks.has(e))throw new Error(\"unlock of a non-locked mutex\");let t=this._locks.get(e).shift();if(t){setTimeout(t,0);return}this._locks.delete(e)}tryLock(e){return this._locks.has(e)?!1:(this._locks.set(e,[]),!0)}isLocked(e){return this._locks.has(e)}};a(Ct,\"Mutex\");var kt=class{constructor(e){this._ready=Promise.resolve(this);this._fs=e,this._mu=new Ct}whenReady(){return this._ready}get metadata(){return G(X({},this._fs.metadata),{name:\"LockedFS<\"+this._fs.metadata.name+\">\"})}get fs(){return this._fs}rename(e,t,i){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.rename(e,t,i),this._mu.unlock(e)})}renameSync(e,t,i){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.renameSync(e,t,i)}stat(e,t){return u(this,null,function*(){yield this._mu.lock(e);let i=yield this._fs.stat(e,t);return this._mu.unlock(e),i})}statSync(e,t){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.statSync(e,t)}access(e,t,i){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.access(e,t,i),this._mu.unlock(e)})}accessSync(e,t,i){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.accessSync(e,t,i)}open(e,t,i,n){return u(this,null,function*(){yield this._mu.lock(e);let s=yield this._fs.open(e,t,i,n);return this._mu.unlock(e),s})}openSync(e,t,i,n){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.openSync(e,t,i,n)}unlink(e,t){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.unlink(e,t),this._mu.unlock(e)})}unlinkSync(e,t){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.unlinkSync(e,t)}rmdir(e,t){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.rmdir(e,t),this._mu.unlock(e)})}rmdirSync(e,t){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.rmdirSync(e,t)}mkdir(e,t,i){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.mkdir(e,t,i),this._mu.unlock(e)})}mkdirSync(e,t,i){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.mkdirSync(e,t,i)}readdir(e,t){return u(this,null,function*(){yield this._mu.lock(e);let i=yield this._fs.readdir(e,t);return this._mu.unlock(e),i})}readdirSync(e,t){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.readdirSync(e,t)}exists(e,t){return u(this,null,function*(){yield this._mu.lock(e);let i=yield this._fs.exists(e,t);return this._mu.unlock(e),i})}existsSync(e,t){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.existsSync(e,t)}realpath(e,t){return u(this,null,function*(){yield this._mu.lock(e);let i=yield this._fs.realpath(e,t);return this._mu.unlock(e),i})}realpathSync(e,t){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.realpathSync(e,t)}truncate(e,t,i){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.truncate(e,t,i),this._mu.unlock(e)})}truncateSync(e,t,i){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.truncateSync(e,t,i)}readFile(e,t,i){return u(this,null,function*(){yield this._mu.lock(e);let n=yield this._fs.readFile(e,t,i);return this._mu.unlock(e),n})}readFileSync(e,t,i){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.readFileSync(e,t,i)}writeFile(e,t,i,n,s){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.writeFile(e,t,i,n,s),this._mu.unlock(e)})}writeFileSync(e,t,i,n,s){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.writeFileSync(e,t,i,n,s)}appendFile(e,t,i,n,s){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.appendFile(e,t,i,n,s),this._mu.unlock(e)})}appendFileSync(e,t,i,n,s){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.appendFileSync(e,t,i,n,s)}chmod(e,t,i){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.chmod(e,t,i),this._mu.unlock(e)})}chmodSync(e,t,i){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.chmodSync(e,t,i)}chown(e,t,i,n){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.chown(e,t,i,n),this._mu.unlock(e)})}chownSync(e,t,i,n){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.chownSync(e,t,i,n)}utimes(e,t,i,n){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.utimes(e,t,i,n),this._mu.unlock(e)})}utimesSync(e,t,i,n){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.utimesSync(e,t,i,n)}link(e,t,i){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.link(e,t,i),this._mu.unlock(e)})}linkSync(e,t,i){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.linkSync(e,t,i)}symlink(e,t,i,n){return u(this,null,function*(){yield this._mu.lock(e),yield this._fs.symlink(e,t,i,n),this._mu.unlock(e)})}symlinkSync(e,t,i,n){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.symlinkSync(e,t,i,n)}readlink(e,t){return u(this,null,function*(){yield this._mu.lock(e);let i=yield this._fs.readlink(e,t);return this._mu.unlock(e),i})}readlinkSync(e,t){if(this._mu.isLocked(e))throw new Error(\"invalid sync call\");return this._fs.readlinkSync(e,t)}};a(kt,\"LockedFS\");var it=\"/.deletedFiles.log\";function gi(r){return 146|r}a(gi,\"makeModeWritable\");function V(r){return w.getFileFlag(r)}a(V,\"getFlag\");var Ut=class extends M{constructor(e,t,i,n,s){super(e,t,i,n,s)}sync(){return u(this,null,function*(){this.isDirty()&&(yield this._fs._syncAsync(this),this.resetDirty())})}syncSync(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())}close(){return u(this,null,function*(){yield this.sync()})}closeSync(){this.syncSync()}};a(Ut,\"OverlayFile\");var Rt=class extends j{constructor({writable:t,readable:i}){super();this._isInitialized=!1;this._deletedFiles={};this._deleteLog=\"\";this._deleteLogUpdatePending=!1;this._deleteLogUpdateNeeded=!1;this._deleteLogError=null;if(this._writable=t,this._readable=i,this._writable.metadata.readonly)throw new c(22,\"Writable file system must be writable.\")}static isAvailable(){return!0}get metadata(){return G(X({},super.metadata),{name:Z.Name,synchronous:this._readable.metadata.synchronous&&this._writable.metadata.synchronous,supportsProperties:this._readable.metadata.supportsProperties&&this._writable.metadata.supportsProperties})}getOverlayedFileSystems(){return{readable:this._readable,writable:this._writable}}_syncAsync(t){return u(this,null,function*(){let i=t.getStats();return yield this.createParentDirectoriesAsync(t.getPath(),i.getCred(0,0)),this._writable.writeFile(t.getPath(),t.getBuffer(),V(\"w\"),i.mode,i.getCred(0,0))})}_syncSync(t){let i=t.getStats();this.createParentDirectories(t.getPath(),i.getCred(0,0)),this._writable.writeFileSync(t.getPath(),t.getBuffer(),V(\"w\"),i.mode,i.getCred(0,0))}_initialize(){return u(this,null,function*(){if(!this._isInitialized){try{let t=yield this._writable.readFile(it,V(\"r\"),E.Root);this._deleteLog=B(t)}catch(t){if(t.errno!==2)throw t}this._isInitialized=!0,this._reparseDeletionLog()}})}getDeletionLog(){return this._deleteLog}restoreDeletionLog(t,i){this._deleteLog=t,this._reparseDeletionLog(),this.updateLog(\"\",i)}rename(t,i,n){return u(this,null,function*(){if(this.checkInitialized(),this.checkPath(t),this.checkPath(i),t===it||i===it)throw c.EPERM(\"Cannot rename deletion log.\");let s=yield this.stat(t,n);if(s.isDirectory()){if(t===i)return;let o=511;if(yield this.exists(i,n)){let l=yield this.stat(i,n);if(o=l.mode,l.isDirectory()){if((yield this.readdir(i,n)).length>0)throw c.ENOTEMPTY(i)}else throw c.ENOTDIR(i)}if((yield this._writable.exists(t,n))?yield this._writable.rename(t,i,n):(yield this._writable.exists(i,n))||(yield this._writable.mkdir(i,o,n)),yield this._readable.exists(t,n))for(let l of yield this._readable.readdir(t,n))yield this.rename(P(t,l),P(i,l),n)}else{if((yield this.exists(i,n))&&(yield this.stat(i,n)).isDirectory())throw c.EISDIR(i);yield this.writeFile(i,yield this.readFile(t,V(\"r\"),n),V(\"w\"),s.mode,n)}t!==i&&(yield this.exists(t,n))&&(yield this.unlink(t,n))})}renameSync(t,i,n){if(this.checkInitialized(),this.checkPath(t),this.checkPath(i),t===it||i===it)throw c.EPERM(\"Cannot rename deletion log.\");let s=this.statSync(t,n);if(s.isDirectory()){if(t===i)return;let o=511;if(this.existsSync(i,n)){let l=this.statSync(i,n);if(o=l.mode,l.isDirectory()){if(this.readdirSync(i,n).length>0)throw c.ENOTEMPTY(i)}else throw c.ENOTDIR(i)}this._writable.existsSync(t,n)?this._writable.renameSync(t,i,n):this._writable.existsSync(i,n)||this._writable.mkdirSync(i,o,n),this._readable.existsSync(t,n)&&this._readable.readdirSync(t,n).forEach(l=>{this.renameSync(P(t,l),P(i,l),n)})}else{if(this.existsSync(i,n)&&this.statSync(i,n).isDirectory())throw c.EISDIR(i);this.writeFileSync(i,this.readFileSync(t,V(\"r\"),n),V(\"w\"),s.mode,n)}t!==i&&this.existsSync(t,n)&&this.unlinkSync(t,n)}stat(t,i){return u(this,null,function*(){this.checkInitialized();try{return this._writable.stat(t,i)}catch(n){if(this._deletedFiles[t])throw c.ENOENT(t);let s=k.clone(yield this._readable.stat(t,i));return s.mode=gi(s.mode),s}})}statSync(t,i){this.checkInitialized();try{return this._writable.statSync(t,i)}catch(n){if(this._deletedFiles[t])throw c.ENOENT(t);let s=k.clone(this._readable.statSync(t,i));return s.mode=gi(s.mode),s}}open(t,i,n,s){return u(this,null,function*(){if(this.checkInitialized(),this.checkPath(t),t===it)throw c.EPERM(\"Cannot open deletion log.\");if(yield this.exists(t,s))switch(i.pathExistsAction()){case 2:return yield this.createParentDirectoriesAsync(t,s),this._writable.open(t,i,n,s);case 0:if(yield this._writable.exists(t,s))return this._writable.open(t,i,n,s);{let o=yield this._readable.readFile(t,V(\"r\"),s),l=k.clone(yield this._readable.stat(t,s));return l.mode=n,new Ut(this,t,i,l,o)}default:throw c.EEXIST(t)}else switch(i.pathNotExistsAction()){case 3:return yield this.createParentDirectoriesAsync(t,s),this._writable.open(t,i,n,s);default:throw c.ENOENT(t)}})}openSync(t,i,n,s){if(this.checkInitialized(),this.checkPath(t),t===it)throw c.EPERM(\"Cannot open deletion log.\");if(this.existsSync(t,s))switch(i.pathExistsAction()){case 2:return this.createParentDirectories(t,s),this._writable.openSync(t,i,n,s);case 0:if(this._writable.existsSync(t,s))return this._writable.openSync(t,i,n,s);{let o=this._readable.readFileSync(t,V(\"r\"),s),l=k.clone(this._readable.statSync(t,s));return l.mode=n,new Ut(this,t,i,l,o)}default:throw c.EEXIST(t)}else switch(i.pathNotExistsAction()){case 3:return this.createParentDirectories(t,s),this._writable.openSync(t,i,n,s);default:throw c.ENOENT(t)}}unlink(t,i){return u(this,null,function*(){if(this.checkInitialized(),this.checkPath(t),yield this.exists(t,i))(yield this._writable.exists(t,i))&&(yield this._writable.unlink(t,i)),(yield this.exists(t,i))&&this.deletePath(t,i);else throw c.ENOENT(t)})}unlinkSync(t,i){if(this.checkInitialized(),this.checkPath(t),this.existsSync(t,i))this._writable.existsSync(t,i)&&this._writable.unlinkSync(t,i),this.existsSync(t,i)&&this.deletePath(t,i);else throw c.ENOENT(t)}rmdir(t,i){return u(this,null,function*(){if(this.checkInitialized(),yield this.exists(t,i)){if((yield this._writable.exists(t,i))&&(yield this._writable.rmdir(t,i)),yield this.exists(t,i)){if((yield this.readdir(t,i)).length>0)throw c.ENOTEMPTY(t);this.deletePath(t,i)}}else throw c.ENOENT(t)})}rmdirSync(t,i){if(this.checkInitialized(),this.existsSync(t,i)){if(this._writable.existsSync(t,i)&&this._writable.rmdirSync(t,i),this.existsSync(t,i)){if(this.readdirSync(t,i).length>0)throw c.ENOTEMPTY(t);this.deletePath(t,i)}}else throw c.ENOENT(t)}mkdir(t,i,n){return u(this,null,function*(){if(this.checkInitialized(),yield this.exists(t,n))throw c.EEXIST(t);yield this.createParentDirectoriesAsync(t,n),yield this._writable.mkdir(t,i,n)})}mkdirSync(t,i,n){if(this.checkInitialized(),this.existsSync(t,n))throw c.EEXIST(t);this.createParentDirectories(t,n),this._writable.mkdirSync(t,i,n)}readdir(t,i){return u(this,null,function*(){if(this.checkInitialized(),!(yield this.stat(t,i)).isDirectory())throw c.ENOTDIR(t);let s=[];try{s=s.concat(yield this._writable.readdir(t,i))}catch(l){}try{s=s.concat((yield this._readable.readdir(t,i)).filter(l=>!this._deletedFiles[`${t}/${l}`]))}catch(l){}let o={};return s.filter(l=>{let d=!o[l];return o[l]=!0,d})})}readdirSync(t,i){if(this.checkInitialized(),!this.statSync(t,i).isDirectory())throw c.ENOTDIR(t);let s=[];try{s=s.concat(this._writable.readdirSync(t,i))}catch(l){}try{s=s.concat(this._readable.readdirSync(t,i).filter(l=>!this._deletedFiles[`${t}/${l}`]))}catch(l){}let o={};return s.filter(l=>{let d=!o[l];return o[l]=!0,d})}exists(t,i){return u(this,null,function*(){return this.checkInitialized(),(yield this._writable.exists(t,i))||(yield this._readable.exists(t,i))&&this._deletedFiles[t]!==!0})}existsSync(t,i){return this.checkInitialized(),this._writable.existsSync(t,i)||this._readable.existsSync(t,i)&&this._deletedFiles[t]!==!0}chmod(t,i,n){return u(this,null,function*(){this.checkInitialized(),yield this.operateOnWritableAsync(t,n),yield this._writable.chmod(t,i,n)})}chmodSync(t,i,n){this.checkInitialized(),this.operateOnWritable(t,n),this._writable.chmodSync(t,i,n)}chown(t,i,n,s){return u(this,null,function*(){this.checkInitialized(),yield this.operateOnWritableAsync(t,s),yield this._writable.chown(t,i,n,s)})}chownSync(t,i,n,s){this.checkInitialized(),this.operateOnWritable(t,s),this._writable.chownSync(t,i,n,s)}utimes(t,i,n,s){return u(this,null,function*(){this.checkInitialized(),yield this.operateOnWritableAsync(t,s),yield this._writable.utimes(t,i,n,s)})}utimesSync(t,i,n,s){this.checkInitialized(),this.operateOnWritable(t,s),this._writable.utimesSync(t,i,n,s)}deletePath(t,i){this._deletedFiles[t]=!0,this.updateLog(`d${t}\n`,i)}updateLog(t,i){this._deleteLog+=t,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(it,S(this._deleteLog),w.getFileFlag(\"w\"),420,i).then(()=>{this._deleteLogUpdateNeeded&&(this._deleteLogUpdateNeeded=!1,this.updateLog(\"\",i))}).catch(n=>{this._deleteLogError=n}).finally(()=>{this._deleteLogUpdatePending=!1}))}_reparseDeletionLog(){this._deletedFiles={},this._deleteLog.split(`\n`).forEach(t=>{this._deletedFiles[t.slice(1)]=t.slice(0,1)===\"d\"})}checkInitialized(){if(this._isInitialized){if(this._deleteLogError!==null){let t=this._deleteLogError;throw this._deleteLogError=null,t}}else throw new c(1,\"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.\")}checkPath(t){if(t===it)throw c.EPERM(t)}createParentDirectories(t,i){let n=F(t),s=[];for(;!this._writable.existsSync(n,i);)s.push(n),n=F(n);s=s.reverse();for(let o of s)this._writable.mkdirSync(o,this.statSync(o,i).mode,i)}createParentDirectoriesAsync(t,i){return u(this,null,function*(){let n=F(t),s=[];for(;!(yield this._writable.exists(n,i));)s.push(n),n=F(n);s=s.reverse();for(let o of s){let l=yield this.stat(o,i);yield this._writable.mkdir(o,l.mode,i)}})}operateOnWritable(t,i){if(!this.existsSync(t,i))throw c.ENOENT(t);this._writable.existsSync(t,i)||this.copyToWritable(t,i)}operateOnWritableAsync(t,i){return u(this,null,function*(){if(!(yield this.exists(t,i)))throw c.ENOENT(t);if(!(yield this._writable.exists(t,i)))return this.copyToWritableAsync(t,i)})}copyToWritable(t,i){let n=this.statSync(t,i);n.isDirectory()?this._writable.mkdirSync(t,n.mode,i):this.writeFileSync(t,this._readable.readFileSync(t,V(\"r\"),i),V(\"w\"),n.mode,i)}copyToWritableAsync(t,i){return u(this,null,function*(){let n=yield this.stat(t,i);n.isDirectory()?yield this._writable.mkdir(t,n.mode,i):yield this.writeFile(t,yield this._readable.readFile(t,V(\"r\"),i),V(\"w\"),n.mode,i)})}};a(Rt,\"UnlockedOverlayFS\");var se=class extends kt{static isAvailable(){return Rt.isAvailable()}constructor(e){super(new Rt(e)),this._ready=this._initialize()}getOverlayedFileSystems(){return super.fs.getOverlayedFileSystems()}getDeletionLog(){return super.fs.getDeletionLog()}resDeletionLog(){return super.fs.getDeletionLog()}unwrap(){return super.fs}_initialize(){return u(this,null,function*(){return yield Ze(se.prototype,this,\"fs\")._initialize(),this})}},Z=se;a(Z,\"OverlayFS\"),Z.Name=\"OverlayFS\",Z.Create=ut.bind(se),Z.Options={writable:{type:\"object\",description:\"The file system to write modified files to.\"},readable:{type:\"object\",description:\"The file system that initially populates this file system.\"}};var oe={};function yi(...r){for(let e of r)oe[e.Name]=e}a(yi,\"registerBackend\");yi(et,q,$,Z);var Lt=class{constructor(e,t){this.key=e;this.value=t;this.prev=null;this.next=null}};a(Lt,\"LRUNode\");var ae=class{constructor(e){this.limit=e;this.size=0;this.map={};this.head=null;this.tail=null}set(e,t){let i=new Lt(e,t);this.map[e]?(this.map[e].value=i.value,this.remove(i.key)):this.size>=this.limit&&(delete this.map[this.tail.key],this.size--,this.tail=this.tail.prev,this.tail.next=null),this.setHead(i)}get(e){if(this.map[e]){let t=this.map[e].value,i=new Lt(e,t);return this.remove(e),this.setHead(i),t}else return null}remove(e){let t=this.map[e];t&&(t.prev!==null?t.prev.next=t.next:this.head=t.next,t.next!==null?t.next.prev=t.prev:this.tail=t.prev,delete this.map[e],this.size--)}removeAll(){this.size=0,this.map={},this.head=null,this.tail=null}setHead(e){e.next=this.head,e.prev=null,this.head!==null&&(this.head.prev=e),this.head=e,this.tail===null&&(this.tail=e),this.size++,this.map[e.key]=e}};a(ae,\"LRUCache\");var Ot=class extends M{constructor(e,t,i,n,s){super(e,t,i,n,s)}sync(){return u(this,null,function*(){this.isDirty()&&(yield this._fs._sync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())})}close(){return u(this,null,function*(){this.sync()})}};a(Ot,\"AsyncKeyValueFile\");var ce=class extends j{constructor(t){super();this._cache=null;t>0&&(this._cache=new ae(t))}static isAvailable(){return!0}init(t){return u(this,null,function*(){this.store=t,yield this.makeRootDirectory()})}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!0}supportsSynch(){return!1}empty(){return u(this,null,function*(){this._cache&&this._cache.removeAll(),yield this.store.clear(),yield this.makeRootDirectory()})}access(t,i,n){return u(this,null,function*(){let s=this.store.beginTransaction(\"readonly\"),o=yield this.findINode(s,t);if(!o)throw c.ENOENT(t);if(!o.toStats().hasAccess(i,n))throw c.EACCES(t)})}rename(t,i,n){return u(this,null,function*(){let s=this._cache;this._cache&&(this._cache=null,s.removeAll());try{let o=this.store.beginTransaction(\"readwrite\"),l=F(t),d=I(t),m=F(i),f=I(i),h=yield this.findINode(o,l),y=yield this.getDirListing(o,l,h);if(!h.toStats().hasAccess(2,n))throw c.EACCES(t);if(!y[d])throw c.ENOENT(t);let v=y[d];if(delete y[d],(m+\"/\").indexOf(t+\"/\")===0)throw new c(16,l);let x,g;if(m===l?(x=h,g=y):(x=yield this.findINode(o,m),g=yield this.getDirListing(o,m,x)),g[f]){let H=yield this.getINode(o,i,g[f]);if(H.isFile())try{yield o.del(H.id),yield o.del(g[f])}catch(gt){throw yield o.abort(),gt}else throw c.EPERM(i)}g[f]=v;try{yield o.put(h.id,S(JSON.stringify(y)),!0),yield o.put(x.id,S(JSON.stringify(g)),!0)}catch(H){throw yield o.abort(),H}yield o.commit()}finally{s&&(this._cache=s)}})}stat(t,i){return u(this,null,function*(){let n=this.store.beginTransaction(\"readonly\"),o=(yield this.findINode(n,t)).toStats();if(!o.hasAccess(4,i))throw c.EACCES(t);return o})}createFile(t,i,n,s){return u(this,null,function*(){let o=this.store.beginTransaction(\"readwrite\"),l=new Uint8Array(0),d=yield this.commitNewFile(o,t,_.FILE,n,s,l);return new Ot(this,t,i,d.toStats(),l)})}openFile(t,i,n){return u(this,null,function*(){let s=this.store.beginTransaction(\"readonly\"),o=yield this.findINode(s,t),l=yield s.get(o.id);if(!o.toStats().hasAccess(i.getMode(),n))throw c.EACCES(t);if(l===void 0)throw c.ENOENT(t);return new Ot(this,t,i,o.toStats(),l)})}unlink(t,i){return u(this,null,function*(){return this.removeEntry(t,!1,i)})}rmdir(t,i){return u(this,null,function*(){if((yield this.readdir(t,i)).length>0)throw c.ENOTEMPTY(t);yield this.removeEntry(t,!0,i)})}mkdir(t,i,n){return u(this,null,function*(){let s=this.store.beginTransaction(\"readwrite\"),o=S(\"{}\");yield this.commitNewFile(s,t,_.DIRECTORY,i,n,o)})}readdir(t,i){return u(this,null,function*(){let n=this.store.beginTransaction(\"readonly\"),s=yield this.findINode(n,t);if(!s.toStats().hasAccess(4,i))throw c.EACCES(t);return Object.keys(yield this.getDirListing(n,t,s))})}chmod(t,i,n){return u(this,null,function*(){yield(yield this.openFile(t,w.getFileFlag(\"r+\"),n)).chmod(i)})}chown(t,i,n,s){return u(this,null,function*(){yield(yield this.openFile(t,w.getFileFlag(\"r+\"),s)).chown(i,n)})}_sync(t,i,n){return u(this,null,function*(){let s=this.store.beginTransaction(\"readwrite\"),o=yield this._findINode(s,F(t),I(t)),l=yield this.getINode(s,t,o),d=l.update(n);try{yield s.put(l.id,i,!0),d&&(yield s.put(o,l.serialize(),!0))}catch(m){throw yield s.abort(),m}yield s.commit()})}makeRootDirectory(){return u(this,null,function*(){let t=this.store.beginTransaction(\"readwrite\");if((yield t.get(W))===void 0){let i=new Date().getTime(),n=new R(ht(),4096,511|_.DIRECTORY,i,i,i,0,0);yield t.put(n.id,S(\"{}\"),!1),yield t.put(W,n.serialize(),!1),yield t.commit()}})}_findINode(o,l,d){return u(this,arguments,function*(t,i,n,s=new Set){let m=U(i,n);if(s.has(m))throw new c(5,\"Infinite loop detected while finding inode\",m);if(s.add(m),this._cache){let f=this._cache.get(m);if(f)return f}if(i===\"/\"){if(n===\"\")return this._cache&&this._cache.set(m,W),W;{let f=yield this.getINode(t,i,W),h=yield this.getDirListing(t,i,f);if(h[n]){let y=h[n];return this._cache&&this._cache.set(m,y),y}else throw c.ENOENT(P(i,n))}}else{let f=yield this.findINode(t,i,s),h=yield this.getDirListing(t,i,f);if(h[n]){let y=h[n];return this._cache&&this._cache.set(m,y),y}else throw c.ENOENT(P(i,n))}})}findINode(s,o){return u(this,arguments,function*(t,i,n=new Set){let l=yield this._findINode(t,F(i),I(i),n);return this.getINode(t,i,l)})}getINode(t,i,n){return u(this,null,function*(){let s=yield t.get(n);if(!s)throw c.ENOENT(i);return R.Deserialize(s)})}getDirListing(t,i,n){return u(this,null,function*(){if(!n.isDirectory())throw c.ENOTDIR(i);let s=yield t.get(n.id);try{return JSON.parse(s.toString())}catch(o){throw c.ENOENT(i)}})}addNewNode(t,i){return u(this,null,function*(){let n=0,s=a(()=>u(this,null,function*(){if(++n===5)throw new c(5,\"Unable to commit data to key-value store.\");{let o=ht();return(yield t.put(o,i,!1))?o:s()}}),\"reroll\");return s()})}commitNewFile(t,i,n,s,o,l){return u(this,null,function*(){let d=F(i),m=I(i),f=yield this.findINode(t,d),h=yield this.getDirListing(t,d,f),y=new Date().getTime();if(!f.toStats().hasAccess(2,o))throw c.EACCES(i);if(i===\"/\")throw c.EEXIST(i);if(h[m])throw yield t.abort(),c.EEXIST(i);try{let v=yield this.addNewNode(t,l),x=new R(v,l.length,s|n,y,y,y,o.uid,o.gid),g=yield this.addNewNode(t,x.serialize());return h[m]=g,yield t.put(f.id,S(JSON.stringify(h)),!0),yield t.commit(),x}catch(v){throw t.abort(),v}})}removeEntry(t,i,n){return u(this,null,function*(){this._cache&&this._cache.remove(t);let s=this.store.beginTransaction(\"readwrite\"),o=F(t),l=yield this.findINode(s,o),d=yield this.getDirListing(s,o,l),m=I(t);if(!d[m])throw c.ENOENT(t);let f=d[m],h=yield this.getINode(s,t,f);if(!h.toStats().hasAccess(2,n))throw c.EACCES(t);if(delete d[m],!i&&h.isDirectory())throw c.EISDIR(t);if(i&&!h.isDirectory())throw c.ENOTDIR(t);try{yield s.del(h.id),yield s.del(f),yield s.put(l.id,S(JSON.stringify(d)),!0)}catch(y){throw yield s.abort(),y}yield s.commit()})}};a(ce,\"AsyncKeyValueFileSystem\");var Tt=class{static fromListing(e){let t=new Tt,i=new rt;t._index[\"/\"]=i;let n=[[\"\",e,i]];for(;n.length>0;){let s,o=n.pop(),l=o[0],d=o[1],m=o[2];for(let f in d)if(Object.prototype.hasOwnProperty.call(d,f)){let h=d[f],y=`${l}/${f}`;h?(t._index[y]=s=new rt,n.push([y,h,s])):s=new Bt(new k(_.FILE,-1,365)),m&&(m._ls[f]=s)}}return t}constructor(){this._index={},this.addPath(\"/\",new rt)}fileIterator(e){for(let t in this._index)if(Object.prototype.hasOwnProperty.call(this._index,t)){let i=this._index[t],n=i.getListing();for(let s of n){let o=i.getItem(s);bi(o)&&e(o.getData())}}}addPath(e,t){if(!t)throw new Error(\"Inode must be specified\");if(e[0]!==\"/\")throw new Error(\"Path must be absolute, got: \"+e);if(Object.prototype.hasOwnProperty.call(this._index,e))return this._index[e]===t;let i=this._split_path(e),n=i[0],s=i[1],o=this._index[n];return o===void 0&&e!==\"/\"&&(o=new rt,!this.addPath(n,o))||e!==\"/\"&&!o.addItem(s,t)?!1:(Xe(t)&&(this._index[e]=t),!0)}addPathFast(e,t){let i=e.lastIndexOf(\"/\"),n=i===0?\"/\":e.substring(0,i),s=e.substring(i+1),o=this._index[n];return o===void 0&&(o=new rt,this.addPathFast(n,o)),o.addItem(s,t)?(t.isDir()&&(this._index[e]=t),!0):!1}removePath(e){let t=this._split_path(e),i=t[0],n=t[1],s=this._index[i];if(s===void 0)return null;let o=s.remItem(n);if(o===null)return null;if(Xe(o)){let l=o.getListing();for(let d of l)this.removePath(e+\"/\"+d);e!==\"/\"&&delete this._index[e]}return o}ls(e){let t=this._index[e];return t===void 0?null:t.getListing()}getInode(e){let t=this._split_path(e),i=t[0],n=t[1],s=this._index[i];return s===void 0?null:i===e?s:s.getItem(n)}_split_path(e){let t=F(e),i=e.slice(t.length+(t===\"/\"?0:1));return[t,i]}};a(Tt,\"FileIndex\");var Bt=class{constructor(e){this.data=e}isFile(){return!0}isDir(){return!1}getData(){return this.data}setData(e){this.data=e}toStats(){return new k(_.FILE,4096,438)}};a(Bt,\"IndexFileInode\");var rt=class{constructor(e=null){this.data=e;this._ls={}}isFile(){return!1}isDir(){return!0}getData(){return this.data}getStats(){return new k(_.DIRECTORY,4096,365)}toStats(){return this.getStats()}getListing(){return Object.keys(this._ls)}getItem(e){let t=this._ls[e];return t||null}addItem(e,t){return e in this._ls?!1:(this._ls[e]=t,!0)}remItem(e){let t=this._ls[e];return t===void 0?null:(delete this._ls[e],t)}};a(rt,\"IndexDirInode\");function bi(r){return!!r&&r.isFile()}a(bi,\"isIndexFileInode\");function Xe(r){return!!r&&r.isDir()}a(Xe,\"isIndexDirInode\");function wi(r,e=0,t=0){return ai(new E(e,t,e,t,e,t)),re.initialize(r)}a(wi,\"initialize\");function Si(r){return u(this,null,function*(){(\"fs\"in r||r instanceof ct)&&(r={\"/\":r});for(let[e,t]of Object.entries(r))typeof t!=\"number\"&&(e=e.toString(),!(t instanceof ct)&&(typeof t==\"string\"&&(t={fs:t}),r[e]=yield Fi(t)));return wi(r)})}a(Si,\"_configure\");function Un(r,e){if(typeof e!=\"function\")return Si(r);Si(r).then(()=>e()).catch(t=>e(t))}a(Un,\"configure\");function Je(t){return u(this,arguments,function*({fs:r,options:e={}}){if(!r)throw new c(1,'Missing \"fs\" property on configuration object.');if(typeof e!=\"object\"||e===null)throw new c(22,'Invalid \"options\" property on configuration object.');let i=Object.keys(e).filter(s=>s!=\"fs\");for(let s of i){let o=e[s];if(o===null||typeof o!=\"object\"||!(\"fs\"in o))continue;let l=yield Je(o);e[s]=l}let n=oe[r];if(n)return n.Create(e);throw new c(1,`File system ${r} is not available in BrowserFS.`)})}a(Je,\"_getFileSystem\");function Fi(r,e){if(typeof e!=\"function\")return Je(r);Je(r).then(t=>e(null,t)).catch(t=>e(t))}a(Fi,\"getFileSystem\");var Rn=re;return Ni(Ln);})();\n//# sourceMappingURL=browser.min.js.map\n"

// AppJS is the string used for [AppJSTmpl].
AppJS = "// -----------------------------------------------------------------------------\n// go-app\n// -----------------------------------------------------------------------------\nvar goappNav = function () { };\nvar goappOnUpdate = function () { };\nvar goappOnAppInstallChange = function () { };\n\nconst goappEnv = {{.Env }};\nconst goappLoadingLabel = \"{{.LoadingLabel}}\";\nconst goappWasmContentLengthHeader = \"{{.WasmContentLengthHeader}}\";\n\nlet wasm;\nlet memoryBytes;\n\nlet goappServiceWorkerRegistration;\nlet deferredPrompt = null;\n\ngoappInitServiceWorker();\ngoappWatchForUpdate();\ngoappWatchForInstallable();\ngoappInitWebAssembly();\n\n// -----------------------------------------------------------------------------\n// Service Worker\n// -----------------------------------------------------------------------------\nasync function goappInitServiceWorker() {\n  if (\"serviceWorker\" in navigator) {\n    try {\n      const registration = await navigator.serviceWorker.register(\n        \"{{.WorkerJS}}\"\n      );\n\n      goappServiceWorkerRegistration = registration;\n      goappSetupNotifyUpdate(registration);\n      goappSetupAutoUpdate(registration);\n      goappSetupPushNotification();\n    } catch (err) {\n      console.error(\"goapp service worker registration failed\", err);\n    }\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Update\n// -----------------------------------------------------------------------------\nfunction goappWatchForUpdate() {\n  window.addEventListener(\"beforeinstallprompt\", (e) => {\n    e.preventDefault();\n    deferredPrompt = e;\n    goappOnAppInstallChange();\n  });\n}\n\nfunction goappSetupNotifyUpdate(registration) {\n  registration.addEventListener(\"updatefound\", (event) => {\n    const newSW = registration.installing;\n    newSW.addEventListener(\"statechange\", (event) => {\n      if (!navigator.serviceWorker.controller) {\n        return;\n      }\n      if (newSW.state != \"installed\") {\n        return;\n      }\n      goappOnUpdate();\n    });\n  });\n}\n\nfunction goappSetupAutoUpdate(registration) {\n  const autoUpdateInterval = \"{{.AutoUpdateInterval}}\";\n  if (autoUpdateInterval == 0) {\n    return;\n  }\n\n  window.setInterval(() => {\n    registration.update();\n  }, autoUpdateInterval);\n}\n\n// -----------------------------------------------------------------------------\n// Install\n// -----------------------------------------------------------------------------\nfunction goappWatchForInstallable() {\n  window.addEventListener(\"appinstalled\", () => {\n    deferredPrompt = null;\n    goappOnAppInstallChange();\n  });\n}\n\nfunction goappIsAppInstallable() {\n  return !goappIsAppInstalled() && deferredPrompt != null;\n}\n\nfunction goappIsAppInstalled() {\n  const isStandalone = window.matchMedia(\"(display-mode: standalone)\").matches;\n  return isStandalone || navigator.standalone;\n}\n\nasync function goappShowInstallPrompt() {\n  deferredPrompt.prompt();\n  await deferredPrompt.userChoice;\n  deferredPrompt = null;\n}\n\n// -----------------------------------------------------------------------------\n// Environment\n// -----------------------------------------------------------------------------\nfunction goappGetenv(k) {\n  return goappEnv[k];\n}\n\n// -----------------------------------------------------------------------------\n// Notifications\n// -----------------------------------------------------------------------------\nfunction goappSetupPushNotification() {\n  navigator.serviceWorker.addEventListener(\"message\", (event) => {\n    const msg = event.data.goapp;\n    if (!msg) {\n      return;\n    }\n\n    if (msg.type !== \"notification\") {\n      return;\n    }\n\n    goappNav(msg.path);\n  });\n}\n\nasync function goappSubscribePushNotifications(vapIDpublicKey) {\n  try {\n    const subscription =\n      await goappServiceWorkerRegistration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: vapIDpublicKey,\n      });\n    return JSON.stringify(subscription);\n  } catch (err) {\n    console.error(err);\n    return \"\";\n  }\n}\n\nfunction goappNewNotification(jsonNotification) {\n  let notification = JSON.parse(jsonNotification);\n\n  const title = notification.title;\n  delete notification.title;\n\n  let path = notification.path;\n  if (!path) {\n    path = \"/\";\n  }\n\n  const webNotification = new Notification(title, notification);\n\n  webNotification.onclick = () => {\n    goappNav(path);\n    webNotification.close();\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Display Image\n// -----------------------------------------------------------------------------\n\nconst appCanvas = document.getElementById('app');\nconst appCanvasCtx = appCanvas.getContext('2d');\n\n// displayImage takes the pointer to the target image in the wasm linear memory\n// and its length. Then, it gets the resulting byte slice and creates an image data\n// with the given width and height.\nfunction displayImage(pointer, length, w, h) {\n  // if it doesn't exist or is detached, we have to make it\n  if (!memoryBytes || memoryBytes.byteLength === 0) {\n    memoryBytes = new Uint8ClampedArray(wasm.instance.exports.mem.buffer);\n  }\n\n  // using subarray instead of slice gives a 5x performance improvement due to no copying\n  let bytes = memoryBytes.subarray(pointer, pointer + length);\n  let data = new ImageData(bytes, w, h);\n  appCanvasCtx.putImageData(data, 0, 0);\n}\n\n// -----------------------------------------------------------------------------\n// Keep Clean Body\n// -----------------------------------------------------------------------------\nfunction goappKeepBodyClean() {\n  const body = document.body;\n  const bodyChildrenCount = body.children.length;\n\n  const mutationObserver = new MutationObserver(function (mutationList) {\n    mutationList.forEach((mutation) => {\n      switch (mutation.type) {\n        case \"childList\":\n          while (body.children.length > bodyChildrenCount) {\n            body.removeChild(body.lastChild);\n          }\n          break;\n      }\n    });\n  });\n\n  mutationObserver.observe(document.body, {\n    childList: true,\n  });\n\n  return () => mutationObserver.disconnect();\n}\n\n// -----------------------------------------------------------------------------\n// Web Assembly\n// -----------------------------------------------------------------------------\n\nasync function goappInitWebAssembly() {\n  const loader = document.getElementById(\"app-wasm-loader\");\n\n  if (!goappCanLoadWebAssembly()) {\n    loader.remove();\n    return;\n  }\n\n  let instantiateStreaming = WebAssembly.instantiateStreaming;\n  if (!instantiateStreaming) {\n    instantiateStreaming = async (resp, importObject) => {\n      const source = await (await resp).arrayBuffer();\n      // memoryBytes = new Uint8Array(resp.instance.exports.mem.buffer);\n      // console.log(\"got memory bytes\", memoryBytes);\n      return await WebAssembly.instantiate(source, importObject);\n    };\n  }\n\n  const loaderIcon = document.getElementById(\"app-wasm-loader-icon\");\n  const loaderLabel = document.getElementById(\"app-wasm-loader-label\");\n\n  try {\n    const showProgress = (progress) => {\n      loaderLabel.innerText = goappLoadingLabel.replace(\"{progress}\", progress);\n    };\n    showProgress(0);\n\n    const go = new Go();\n    wasm = await instantiateStreaming(\n      fetchWithProgress(\"{{.Wasm}}\", showProgress),\n      go.importObject,\n    );\n    go.run(wasm.instance);\n    loader.remove();\n  } catch (err) {\n    loaderIcon.className = \"goapp-logo\";\n    loaderLabel.innerText = err;\n    console.error(\"loading wasm failed: \", err);\n  }\n}\n\nfunction goappCanLoadWebAssembly() {\n  if (\n    /bot|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)\n  ) {\n    return false;\n  }\n\n  const urlParams = new URLSearchParams(window.location.search);\n  return urlParams.get(\"wasm\") !== \"false\";\n}\n\nasync function fetchWithProgress(url, progess) {\n  const response = await fetch(url);\n\n  let contentLength;\n  try {\n    contentLength = response.headers.get(goappWasmContentLengthHeader);\n  } catch { }\n  if (!goappWasmContentLengthHeader || !contentLength) {\n    contentLength = response.headers.get(\"Content-Length\");\n  }\n\n  const total = parseInt(contentLength, 10);\n  let loaded = 0;\n\n  const progressHandler = function (loaded, total) {\n    progess(Math.round((loaded * 100) / total));\n  };\n\n  var res = new Response(\n    new ReadableStream(\n      {\n        async start(controller) {\n          var reader = response.body.getReader();\n          for (; ;) {\n            var { done, value } = await reader.read();\n\n            if (done) {\n              progressHandler(total, total);\n              break;\n            }\n\n            loaded += value.byteLength;\n            progressHandler(loaded, total);\n            controller.enqueue(value);\n          }\n          controller.close();\n        },\n      },\n      {\n        status: response.status,\n        statusText: response.statusText,\n      }\n    )\n  );\n\n  for (var pair of response.headers.entries()) {\n    res.headers.set(pair[0], pair[1]);\n  }\n\n  return res;\n}\n"

// ManifestJSON is the string used for [ManifestJSONTmpl].
ManifestJSON = "{\n  \"short_name\": \"{{.ShortName}}\",\n  \"name\": \"{{.Name}}\",\n  \"description\": \"{{.Description}}\",\n  \"icons\": [\n    {\n      \"src\": \"{{.SVGIcon}}\",\n      \"type\": \"image/svg+xml\",\n      \"sizes\": \"any\"\n    },\n    {\n      \"src\": \"{{.LargeIcon}}\",\n      \"type\": \"image/png\",\n      \"sizes\": \"512x512\"\n    },\n    {\n      \"src\": \"{{.DefaultIcon}}\",\n      \"type\": \"image/png\",\n      \"sizes\": \"192x192\"\n    }\n  ],\n  \"scope\": \"{{.Scope}}\",\n  \"start_url\": \"{{.StartURL}}\",\n  \"background_color\": \"{{.BackgroundColor}}\",\n  \"theme_color\": \"{{.ThemeColor}}\",\n  \"display\": \"standalone\"\n}"

// AppCSS is the string used for app.css.
AppCSS = "body {\n  margin: 0;\n  overflow: hidden;\n}\n\n#app {\n  width: 100vw;\n  height: 100vh;\n\n  /* no selection of canvas */\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  outline: none;\n  -webkit-tap-highlight-color: rgba(255, 255, 255, 0); /* mobile webkit */\n}\n\n#text-field {\n  position: fixed;\n  opacity: 0;\n  top: 0;\n  left: 0;\n}\n\n/*------------------------------------------------------------------------------\n  Loader\n------------------------------------------------------------------------------*/\n.goapp-app-info {\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 1000;\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen,\n    Ubuntu, Cantarell, \"Open Sans\", \"Helvetica Neue\", sans-serif;\n  font-size: 13px;\n  font-weight: 400;\n  color: white;\n  background-color: #2d2c2c;\n}\n\n@media (prefers-color-scheme: light) {\n  .goapp-app-info {\n    color: black;\n    background-color: #f6f6f6;\n  }\n}\n\n.goapp-logo {\n  max-width: 100px;\n  max-height: 100px;\n  user-select: none;\n  -moz-user-select: none;\n  -webkit-user-drag: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n}\n\n.goapp-label {\n  margin-top: 12px;\n  font-size: 21px;\n  font-weight: 100;\n  letter-spacing: 1px;\n  max-width: 480px;\n  text-align: center;\n}\n\n.goapp-spin {\n  animation: goapp-spin-frames 1.21s infinite linear;\n}\n\n@keyframes goapp-spin-frames {\n  from {\n    transform: rotate(0deg);\n  }\n\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n/*------------------------------------------------------------------------------\n  Not found\n------------------------------------------------------------------------------*/\n.goapp-notfound-title {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 65pt;\n  font-weight: 100;\n}\n"

// IndexHTML is the string used for [IndexHTMLTmpl].
IndexHTML = "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"author\" content=\"{{.Author}}\">\r\n    <meta name=\"description\" content=\"{{.Desc}}\">\r\n    <meta name=\"keywords\" content=\"{{.Keywords}}\">\r\n    <meta name=\"theme-color\" content=\"{{.ThemeColor}}\">\r\n    <meta name=\"viewport\"\r\n        content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover\">\r\n    <meta property=\"og:url\" content=\"http://127.0.0.1:60452/\">\r\n    <meta property=\"og:title\" content=\"{{.Title}}\">\r\n    <meta property=\"og:description\" content=\"{{.Desc}}\">\r\n    <meta property=\"og:type\" content=\"website\">\r\n    <meta property=\"og:image\" content=\"{{.Image}}\">\r\n    <title>{{.Title}}</title>\r\n    <link type=\"text/css\" rel=\"preload\" href=\"app.css\" as=\"style\">\r\n    <link rel=\"icon\" href=\"icons/svg.svg\">\r\n    <link rel=\"apple-touch-icon\" href=\"icons/192.png\">\r\n    <link rel=\"manifest\" href=\"manifest.webmanifest\">\r\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"app.css\">\r\n    <script src=\"browserfs.js\"></script>\r\n    <script defer src=\"wasm_exec.js\"></script>\r\n    <script defer src=\"app.js\"></script>\r\n</head>\r\n\r\n<body>\r\n    <canvas id=\"app\" contenteditable=\"true\"></canvas>\r\n    <input id=\"text-field\" type=\"text\">\r\n    <aside id=\"app-wasm-loader\" class=\"goapp-app-info\">\r\n        <img class=\"goapp-logo goapp-spin\" src=\"icons/512.png\" id=\"app-wasm-loader-icon\">\r\n        <p id=\"app-wasm-loader-label\" class=\"goapp-label\">Loading {{.Title}}...</p>\r\n    </aside>\r\n</body>\r\n\r\n</html>"

)
